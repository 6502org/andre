<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />
<meta name="author" content="" />

<meta name="description" content="" />
<meta name="keywords" content="Commodore PET 6502 65816 CPU" />
<link rev="made" href="mailto:" />
<link rel="stylesheet" title="Default" type="text/css" href="../style2-min.css" /><link href="../shariff.complete.css" rel="stylesheet" />
<title>Commodore PET 65816 CPU card</title></head>
<body><div id="mainbox"><a name="top" id="top"></a><div id="topsearch"><form method="get" action="http://www.google.com/search" target="_blank" autocomplete="off"><input id="searchinput" alt="search" name="q" size="10" maxlength="255" type="text" value="" /><input class="advbutton" value="Search site" type="submit" /><div id="srchprov">(by Google)</div><input name="sitesearch" value="www.6502.org/users/andre" type="hidden" /></form><div id="topfind"><div id="topprogress"></div></div></div><div id="menubox">


<div id="menu1" class="mclose">
<div id="twist1" class="twisty"></div>
<div class="hdrtxt"><a href="../index.html">Home&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="../index.html">Home</a></li>
<li><a href="../contact.html">Contact</a></li>
<li><a href="../design.html">Web design</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Hardware</span></li>
<li><ul class="nav2" >
<li><a href="../65k/index.html">The 65k Project</a>
</li>
<li><a href="../pet816/index.html">PET816 Accelerator</a>
</li>
<li><a href="../csa/index.html">CS/A65</a>
</li>
<li><a href="../cbmhw/index.html">CBM mods</a>
</li>
<li><a href="../spi65b/index.html">SPI65B</a>
</li>
<li><a href="../xs1541/index.html">XS1541</a>
</li>
<li><a href="../mischw/index.html">Other hardware</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Software</span></li>
<li><ul class="nav2" >
<li><a href="../osa/index.html">GeckOS</a>
</li>
<li><a href="../lib6502/index.html">lib6502 </a>
</li>
<li><a href="../o65/index.html">o65</a>
</li>
<li><a href="../usb65/index.html">usb65</a>
</li>
<li><a href="../xd2031/index.html">XD2031</a>
</li>
<li><a href="../misc/index.html">Misc</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Library</span></li>
<li><ul class="nav2" >
<li><a href="../petindex/index.html">PETindex</a>
</li>
<li><a href="../petindex/drives/index.html">PET drives</a>
</li>
<li><a href="../adv65/index.html">Advanced 6502</a>
</li>
<li><a href="../hwinfo/index.html">ICs and Standards</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Knowledge Bits</span></li>
<li><ul class="nav2" >
<li><a href="../icapos/index.html">Computer/OS Architecture</a>
</li>
<li><a href="../icaphw/index.html">6502 Hardware Bits</a>
</li>
<li><a href="../emulation/index.html">Emulation</a>
</li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
<div id="menu2" class="mopen">
<div id="twist2" class="twisty"></div>
<div class="hdrtxt"><a href="index.html">PET816 Accelerator&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="index.html">PET816 Accelerator</a></li>
<li><a href="features.html">Board Features</a></li>
<li><a href="works.html">How it works</a></li>
<li><a href="gallery.html">PET816 Gallery</a></li>
<li><a href="hardware.html">Hardware</a></li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
	</div><div id="midcol"><div class="top" id="content"><div id="minmax"></div>

<h1>Commodore PET 65816 CPU card</h1>

<div class="overview"><p>
			This a PET 65816 CPU card! It speeds up your PET to up to 10MHz.
			In fact it's a 6502 replacement card and could be used in other 6502-based
			computers as well.
			The board uses a 65816 CPU that runs at up to 10MHz, plus a Xilinx CPLD as logic glue. It includes
			up to 1MByte fast RAM (run at CPU speed) plus up to 512k parallel Flash ROM (in-system programmable), that can be used as boot ROM.
	</p>
	<div class="rightimg"><a href="imgs/gal_speed.png"><img alt="8296 benchmark screen" src="imgs/gal_speed_small.png" /></a><br />The board prototype installed in a Commodore 8296 - running a benchmark at 10 MHz!
		                </div>	<p>
The interface itself is, in fact, pretty simple. It is a board that is plugged 
in the 6502 CPU socket of the PET. On the board there is the CPU, the CPLD logic, the new clock generator (50MHz), some few support 
parts, as well as two 512k static RAM and one 512k Flash RAM chip. The board is all-through-hole - i.e. no SMD parts! I call that 
a feature in these days.
	</p><p>
		The prototype has been tested with my <a href="../csa/index.html">CS/A65</a> computer, in the MMU board - which is 
		easier to handle when you have to change things often. But it also now runs in the CBM8296. Tests with other PETs will follow.
	</p><p>Here's a small demo (note: don't judge the absolute speed of the demo - only the difference between 1 and 10 MHz. I just didn't have enough time to really do the optimization...</p>
<iframe width="420" height="315" src="http://www.youtube-nocookie.com/embed/ar45QJisxSg" frameborder="0" allowfullscreen="1"></iframe>
<p>After some optimization described in this <a class="extlink" target="_blank" href="http://blog.extrapages.de/archives/20140804-The-anatomy-of-a-microbenchmark.html">blog entry</a> I managed to get it faster by a factor of two (only with optimization of BASIC code):</p>
<iframe width="560" height="315" src="http://www.youtube-nocookie.com/embed/AUkQB_b16SI" frameborder="0" allowfullscreen="1"></iframe><br />
	<p>
		Please also look at these pages:
		</p>
		<ul><li><a href="features.html">Features page</a></li>
		<li><a href="works.html">How it works</a> page.</li>
		<li><a href="hardware.html">Hardware</a> page</li>
		<li><a href="gallery.html">Gallery</a> page</li>
		</ul>
	
</div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="news" id="news">News:</a></h2></div><div class="h2c"><ul class="news"><li><div> </div><small>2013-10-13</small>
			Added video link
		</li><li><div> </div><small>2010-09-05</small>
			Added info and pet debug code for PET 4032
		</li><li><div> </div><small>2010-08-28</small>
			New 1.2B version of the board, with board layout, and updated VHDL code.
			Also added <a href="features.html">features</a>, <a href="hardware.html">Hardware</a>, <a href="gallery.html">Gallery</a> and <a href="works.html">how it works</a> page.
		</li><li><div> </div><small>2010-08-14</small>
			New version of the board, now with board layout, and updated VHDL code.
			Explanations still to come though.
		</li><li><div> </div><small>2010-04-20</small>
			Published the board.
		</li></ul></div></div><div id="toc" class="h2"><div class="h2h"><div class="h2t"> </div><h2>Table of content</h2></div><div class="h2c"><ul><li><a href="#driver">Driver</a></li><li style="list-style-type:none;"><ul><li><a href="#driver1">PET 4032 test machine</a></li><li><a href="#driver2">Testsuite</a></li><li><a href="#driver3">VHDL code</a></li></ul></li><li><a href="#boards">Board Revisions</a></li><li style="list-style-type:none;"><ul><li><a href="#board1">1.2b</a> (ok)</li><li><a href="#board2">1.2a</a> (prototype)</li><li><a href="#board3">1.0b</a> (prototype)</li></ul></li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="driver" id="driver">Driver</a></h2></div><div class="h2c"><div class="driver"><h3><a name="driver1" id="driver1">PET 4032 test machine</a></h3><div class="driverdesc"><p>I tried to repair a PET 4032 machine, that seems to have a memory problem.
			So I put in the 65816 board, with some boot code in the ROM, to run the PET
			in the 65816 board only. The result can be seen in the gallery, the PET
			runs at 10 MHz.
			</p> <p>
			The boot code consists of the original 4032 (non-CRTC) ROMs 
			plus some init code that copies the ROM contents from the board's ROM
			(i.e. not from the PET's original ROMs, that could be broken!)
			to fast RAM, and runs the system completely from the fast RAM.
			Only I/O is used and I was lucky that this works on my 4032, so I 
			can use - and debug - the machine even with programs from the disk drive.
			</p><p>
			The code in the file below builds a <code>PDEBUG</code> PET binary, that
			when run, programs the boot ROM of the 65816 board. It assumes a 128k
			Atmel Flash PROM for the write algorithm, as does the <code>progrom</code>
			programs below.
			</p>
		</div><div class="driverfiles"><table class="files">
<tr class="R1"><td><div class="i_driver"> </div></td>
<td><a href="petdebug.tar.gz">petdebug.tar.gz</a>(PET 4032 test ROM)</td>
</tr></table></div><div class="driverend"></div></div><div class="driver"><h3><a name="driver2" id="driver2">Testsuite</a></h3><div class="driverdesc"><p>Here are some small tests that test the various features of the board.
		</p><p>Note that building them requires the <code>xa</code> cross assembler, using 
		the <code>-w</code> switch to enable 65816 code, as well as <code>petcat</code> 
		from the VICE emulator package to build the BASIC parts.
		</p><p>Here is a description of the different tests (by subdirectory):</p>
		<ul>
		<li>benchmark - builds the <code>BENCH</code> benchmark program used to check the
			speed of the various settings. Builds from the <code>BENCH.basic</code> BASIC
			source as 
			well as <code>benchcode.a65</code> and <code>eichcode.a65</code> assembler
			sources.</li>
		<li>eichtest - builds the burn-in test that, at its start, shows how fast the system
			actually works (uses screen interrupts to determine system speed, so works
			on my 2 MHz PET replica as well. Builds the <code>LOOP</code> Commodore
			PET BASIC executable from <code>LOOP5.basic</code> and 
			<code>eichcode.a65</code>.</li>
		<li>maptest - some mapping tests. <code>COPY</code> copies 4k data from the system memory
			mirror at $e0xxxx to  bank 0. <code>GOFAST</code> copies the system from
			slow memory over to the fast RAM mirror, and switches to it. <code>MAPTEST</code>
			compares the slow memory with the system memory mirror at $e0xxxx.</li>
		<li>modes - builds the <code>GOFAST</code> and <code>GOSLOW</code> programs that
			move execution to either fast RAM or back into slow memory. <code>GOFAST</code>
			is updated compared to the maptest version though.</li>
		<li>progrom - programs the ROM to run a "GOFAST" functionality directly on reset,
			as a boot rom. If you program your on-board ROM with this <code>PGOFAST</code>
			code, and set the bootrom jumper, the system will automatically boot into 
			fast mode.(Edit: the programming algorithm in <code>proglib.a65</code> has
			problems with larger blocks - better use the <code>proglib.a65</code> 
			code from <code>petdebug.tar.gz</code> above)</li>
		</ul>
		</div><div class="driverfiles"><table class="files">
<tr class="R1"><td><div class="i_driver"> </div></td>
<td><a href="x816tests-1.0.tgz">x816tests-1.0.tgz</a>(Feature test suite)</td>
</tr></table></div><div class="driverend"></div></div><div class="driver"><h3><a name="driver3" id="driver3">VHDL code</a></h3><div class="driverdesc"><p>
			This is the VHDL code for the board. It is packaged as the XILINX ISE Webpack (v11.1) directory. Included in this directory is a "testbench" directory with some simulation test runs. Requires Linux with ghdl and GTKWave installed, then look into the Makefile.
		</p><p>
		Version 1.7.1 just has an updated testsuite.
		</p></div><div class="driverfiles"><table class="files">
<tr class="R1"><td><div class="i_logic"> </div></td>
<td><a href="PET816_1.7.1.tar.bz2">PET816_1.7.1.tar.bz2</a>(Archive of the XILINX ISE Webpack CPLD logic - includes VHDL source, JED binary file, as well as a testbench. )</td>
</tr>
<tr class="R0"><td><div class="i_logic"> </div></td>
<td><a href="PET816_1.7.tar.bz2">PET816_1.7.tar.bz2</a>(Archive of the XILINX ISE Webpack CPLD logic - includes VHDL source, JED binary file, as well as a testbench. )</td>
</tr>
<tr class="R1"><td><div class="i_logic"> </div></td>
<td><a href="PET816_1.5.tar.bz2">PET816_1.5.tar.bz2</a>(Archive of the XILINX ISE Webpack CPLD logic - includes VHDL source, JED binary file, as well as a testbench. )</td>
</tr>
<tr class="R0"><td><div class="i_logic"> </div></td>
<td><a href="PET816_1.0.tar.bz2">PET816_1.0.tar.bz2</a>(Archive of the XILINX ISE Webpack CPLD logic - includes VHDL source, JED binary file, as well as a testbench. )</td>
</tr>
<tr class="R1"><td><div class="i_logic"> </div></td>
<td><a href="imgs/gtkwave.png">imgs/gtkwave.png</a>(Sample screenshot of the timing simulation in the testbench)</td>
</tr></table></div><div class="driverend"></div></div></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="boards" id="boards">Board revisions</a></h2></div><div class="h2c"><div class="rev"><h3><a name="board1" id="board1">Version: 1.2b</a></h3>
<div class="revdesc"><p>Status: ok</p>
</div><div class="revnotes"><h4>Notes</h4><table class="notes"><tr><td class="noteicon"><div class="i_msg"> </div></td>
<td>
			This board is an update on the 1.2A, and only contains a few small changes:
			Two delay loops that can be used in the VHDL code have been added. Also
			an "official" diagnostics pin has been added too, to get easy access to a 
			signal "exported" from the CPLD.
		</td></tr>
</table></div><div class="revfiles"><h4>Files</h4><table class="files">
<tr class="R1"><td><div class="i_schem"> </div></td>
<td><a href="pet_cpu816-v1.2b.sch">pet_cpu816-v1.2b.sch</a></td>
</tr>
<tr class="R0"><td><div class="i_layout"> </div></td>
<td><a href="pet_cpu816-v1.2b.brd">pet_cpu816-v1.2b.brd</a></td>
</tr>
<tr class="R1"><td><div class="i_schem"> </div></td>
<td><a href="pet_cpu816-v1.2b-sch.png">pet_cpu816-v1.2b-sch.png</a></td>
</tr>
<tr class="R0"><td><div class="i_layout"> </div></td>
<td><a href="pet_cpu816-v1.2b-brd.png">pet_cpu816-v1.2b-brd.png</a></td>
</tr></table>
</div><div class="revend"></div></div><div class="rev"><h3><a name="board2" id="board2">Version: 1.2a</a></h3>
<div class="revdesc"><p>Status: prototype</p>
</div><div class="revnotes"><h4>Notes</h4><table class="notes"><tr><td class="noteicon"><div class="i_warn"> </div></td>
<td>
			This board has been only barely tested
		</td></tr>
</table></div><div class="revfiles"><h4>Files</h4><table class="files">
<tr class="R1"><td><div class="i_schem"> </div></td>
<td><a href="pet_cpu816-v1.2a.sch">pet_cpu816-v1.2a.sch</a></td>
</tr>
<tr class="R0"><td><div class="i_layout"> </div></td>
<td><a href="pet_cpu816-v1.2a.brd">pet_cpu816-v1.2a.brd</a></td>
</tr>
<tr class="R1"><td><div class="i_schem"> </div></td>
<td><a href="pet_cpu816-v1.2a-sch.png">pet_cpu816-v1.2a-sch.png</a></td>
</tr>
<tr class="R0"><td><div class="i_layout"> </div></td>
<td><a href="pet_cpu816-v1.2a-brd.png">pet_cpu816-v1.2a-brd.png</a></td>
</tr></table>
</div><div class="revend"></div></div><div class="rev"><h3><a name="board3" id="board3">Version: 1.0b</a></h3>
<div class="revdesc"><p>Status: prototype</p>
</div><div class="revnotes"><h4>Notes</h4><table class="notes"><tr><td class="noteicon"><div class="i_warn"> </div></td>
<td>
			This board has been only barely tested
		</td></tr>
</table></div><div class="revfiles"><h4>Files</h4><table class="files">
<tr class="R1"><td><div class="i_schem"> </div></td>
<td><a href="pet_cpu816-v1.0b.sch">pet_cpu816-v1.0b.sch</a></td>
</tr>
<tr class="R0"><td><div class="i_schem"> </div></td>
<td><a href="pet_cpu816-v1.0b-sch.png">pet_cpu816-v1.0b-sch.png</a></td>
</tr></table>
</div><div class="revend"></div></div></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2>Disclaimer</h2></div><div class="h2c">
All Copyrights are acknowledged.
The information here is provided under the terms of the
GNU Public License version 2 unless noted otherwise.
	</div></div><div id="contentfooter"><p>Last modified: 2010-08-29.</p>
<p>Return to <a href="../index.html">Homepage</a></p>

</div></div></div><div id="rightcol"><div class="top" id="share"><div class="tophead">share</div><div><div class="shariff" data-backend-url="https://fachat-shariff-backend.eu-gb.mybluemix.net/" data-theme="grey" data-orientation="vertical"></div></div></div><div class="top" id="twitter"><div class="tophead">follow</div><div><p>Follow my 8-bit tweets on
		            <a class="extlink" target="_blank" href="https://twitter.com/#!/search/realtime/afachat%20%238bit">Twitter</a> (In new window)</p></div></div><div class="top" id="forum"><div class="tophead">discuss</div><div><p>Discuss my site on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=956">this 6502.org forum thread</a></p><p>Discuss this page's content on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=1573"> this 6502.org forum thread</a></p><p>(Forum registration required to post)</p></div></div><div class="top" id="hot"><div class="tophead">hot!</div><div>
<p>Dive into the retro feeling and build yourself a <a href="../cbmhw/ryofat40/index.html">Commodore PET replica</a></p>
<p>Need more speed? Speed up your 6502 computer with this <a href="../pet816/index.html">10&nbsp;MHz 6502 CPU accelerator board</a></p>
<p>Interested in electronics design? Look at the <a href="../icaphw/design.html">design lesson</a> I got from Bil Herd, the hardware designer of the C128</p>
<p>Want 64bit? - pimp the 6502 with the <a href="../65k/index.html">65k processor design!</a></p>

		</div></div></div><div id="footer"> </div></div><script type="text/javascript">myUp="../";</script><script type="text/javascript" src="../scripts2-all.js"></script><script type="text/javascript" src="../shariff.min.js"></script></body></html>
