function dumpArrayToString(a,sep,start){rv="";l=a.length;for(i=start;i<l;i++){if(i>1){rv=rv+sep}rv=rv+a[i]}return rv}function getPathFromId(p){var spl=p.split("_");return dumpArrayToString(spl,"/",1)}function processMenu(target,data,loaded){if(loaded&&typeof data=="string"){var id=$(target).attr("id");var path=getPathFromId(id);var rpath=myUp+path+"/";var spl=data.split("%");var l=spl.length;for(i=0;i<l;i++){t=spl[i];if(t=="xup"){spl[i]=myUp}if(t=="up"){spl[i]=rpath}}data=dumpArrayToString(spl,"",0);if($(target).children("ul").size()==0){$(target).append(data)}bindMenu(target);bindMinus(target)}return(!loaded)||(typeof data=="string"&&data.length>0)}function loadMenu(r,process){var target=r;var id=$(target).attr("id");var path=getPathFromId(id);var ul=$(target).children("ul");if($(ul).size()==0){$.get(myUp+path+"/.menu.xml",function(data){process(target,data,true)},"html")}else{$(r).children("ul").show();process(target,"",false)}}function setupAjax(){$("div#menu").ajaxError(function(ev,req,opts,error){alert("req.url="+opts.url+": "+error.message)})}function hideMenu(){var r=$(this).parent();$(r).children("ul").hide();bindPlus(r);return false}function showMenu(){var r=$(this).parent();loadMenu(r,function(target,data,loaded){var ok=processMenu(target,data,loaded);if(ok){bindMinus(r);$(r).children("ul").children("li.dirm").each(function(i,e){$(e).children("ul").hide();bindPlus(e)})}});return false}function bindPlus(el){$(el).removeClass();$(el).addClass("dirp");var img=$(el).children("div");$(img).css({"background-position":"-32px -64px"});$(img).unbind();$(img).click(showMenu)}function bindMinus(el){$(el).removeClass();$(el).addClass("dirm");var img=$(el).children("div");$(img).css({"background-position":"-64px -64px"});$(img).unbind();$(img).click(hideMenu)}function bindMenu(el){$(el).find("li.dir").each(function(index,el){if($(el).children("ul").size()!=0){bindMinus(el)}else{bindPlus(el)}})}function triggerExpand(parent){$(parent).find("li").show();$(parent).find("li.dirp").each(function(i,e){loadMenu(e,function(target,data,loaded){var ok=processMenu(target,data,loaded);if(ok){bindMinus(target);if(loaded){triggerExpand(target)}}})})}function expandAll(){var v=$("div#menu ul");$(v).show();triggerExpand($(v))}function collapseAll(){var topul=$("div#menu").children().children("ul");$(topul).show();$(topul).children("li").each(function(i,e){$(e).show();$(e).children("ul").hide();if($(e).hasClass("dirm")){bindPlus(e)}})}var currentFilter="";function triggerFilter(parent,filter){$(parent).children("li").each(function(i,e){$(e).hide();if($(e).hasClass("dirp")||$(e).hasClass("dirm")){loadMenu(e,function(target,data,loaded){processMenu(target,data,loaded);triggerFilter($(target).children("ul"),filter)})}if($(e).text().toLowerCase().indexOf(currentFilter)>=0){$(e).show();$(e).parents().each(function(i,x){$(x).show();if($(x).hasClass("dirp")){bindMinus(x)}})}})}function changeFilter(val){currentFilter=val.toLowerCase();var filter=currentFilter;var v=$("div#menu").children().children("ul");$(v).hide();triggerFilter($(v),filter)}function checkValue(){var t=$("div#menu input");var val=$(t).attr("value");if(val.length==0){if(currentFilter!=""){changeFilter(val)}}else{if(val.length>1){if(currentFilter!=val){changeFilter(val)}}}}var isFilterActive=0;function monitorFilter(){checkValue();if(isFilterActive==1){setTimeout(monitorFilter,40)}}function setupFilter(){$("div#menu img#expand").click(expandAll);$("div#menu img#collapse").click(collapseAll);$("div#menu img#cancel").click(function(){isFilterActive=0;currentFilter="";expandAll();$("div#menu input").attr("value","")});$("div#menu input").focusin(function(){$(this).css({"background-color":"#fc6"});$(this).attr("value","");$(this).unbind("focusin");$(this).focusin(function(){$(this).css({"background-color":"#fc6"});if(currentFilter.length>1){changeFilter(currentFilter)}isFilterActive=1;setTimeout(monitorFilter,40)});isFilterActive=1;setTimeout(monitorFilter,40)});$("div#menu input").focusout(function(){$(this).css({"background-color":"#fff"});isFilterActive=0})}function doInit(){$("div#filter").show();bindMenu($("div#menu"));setupAjax();setupFilter()}function doTimer(){if($("div#twitter:visible").size()>0){doInit()}else{setTimeout(doTimer,1000)}}$(document).ready(function(){doInit()});