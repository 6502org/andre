<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="author" content="Andr&eacute;  Fachat">

<meta name="description" content="6502 blitter block transfer engine">
<meta name="keywords" content="6502 blitter block transfer engine">
<link rev="made" href="mailto:afachat@gmx.de">
<link rel="stylesheet" title="Default" type="text/css" href="../../style-min.css"><link rel="alternate stylesheet" title="Advanced" type="text/css" href="../../advanced.css">
<title>Blitter - how it works</title></head>
<body><div id="mainbox"><a name="top"></a><div id="leftcol"><div id="menu" class="top"><div class="tophead">navigate</div><div id="filter"><form action="#"><table id="filterbox"><tr><td><input alt="menu filter" size="8" name="filter" value="filter" type="text"></td><td><div id="cancel" class="i_cancel">&nbsp;</div></td></tr></table><table id="expcol"><tr><td><div id="expand" class="i_expand">&nbsp;</div></td><td><div id="collapse" class="i_collapse">&nbsp;</div></td></tr></table></form></div>
<div id="mtree">
<a id="m_homepage" href="../../index.html">Homepage</a>
<ul class="menu0" >
<li class="separator">Commodore</li>
<li class="dir" id="m_petindex"><div class="i_dir">&nbsp;</div><a href="../../petindex/index.html">CBM PETindex</a>

</li>
<li class="dir" id="m_cbmhw"><div class="i_dir">&nbsp;</div><a href="../../cbmhw/index.html">CBM hardware and mods</a>

</li>
<li class="separator">Hardware</li>
<li class="dir" id="m_65k"><div class="i_dir">&nbsp;</div><a href="../../65k/index.html">The 65k Project</a>

</li>
<li class="dir" id="m_csa"><div class="i_dir">&nbsp;</div><a href="../../csa/index.html">CS/A65 Caspaer and Gecko computer</a>

<ul class="menu1" >
<li><div class="i_file">&nbsp;</div><a href="../memmap.html">Memory Map</a></li>
<li class="separator">Specifications</li>
<li><div class="i_file">&nbsp;</div><a href="../bus.html">Bus V1.0</a></li>
<li><div class="i_file">&nbsp;</div><a href="../bus-1.1.html">Bus V1.1</a></li>
<li class="separator">Main boards</li>
<li><div class="i_file">&nbsp;</div><a href="../cpu/index.html">CS/A65 CPU</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../bios/index.html">CS/A65 BIOS </a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../cpu816v2/index.html">65816 CPU V2</a>
</li>
<li class="dir" id="m_csa_petcpu"><div class="i_dir">&nbsp;</div><a href="../petcpu/index.html">64k PET CPU</a>

</li>
<li class="dir" id="m_csa_gecko"><div class="i_dir">&nbsp;</div><a href="../gecko/index.html">Gecko</a>

</li>
<li><div class="i_file">&nbsp;</div><a href="../auxcpu/index.html">Auxiliary CPU</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../pwr/index.html">Power Supply</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../term/index.html">Bus terminators</a>
</li>
<li class="separator">I/O boards</li>
<li><div class="i_file">&nbsp;</div><a href="../vdc/index.html">Video board</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../petio/index.html">CBM PET I/O</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../netusb/index.html">Net/USB/SD</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../etholi/index.html">Ethernet</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../usb/index.html">USB</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../shug/index.html">PC floppy</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../drvio/index.html">DRVIO floppy and IEC</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../duart/index.html">Double UART (RS232)</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../scsi/index.html">SCSI/I2C board</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../spi/index.html">MMC/SD-Card</a>
</li>
<li class="separator">Special purpose</li>
<li class="dir" id="m_csa_blitter"><div class="i_dir">&nbsp;</div><a href="../blitter/index.html">Block transfer</a>

<ul class="menu2" >
<li><div class="i_file">&nbsp;</div><a href="works.html" class="mcurrent">How it works</a></li>
</ul>
</li>
<li><div class="i_file">&nbsp;</div><a href="../ramdisk/index.html">SIMM RAMDisk</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../copro/index.html">Coprocessor board</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../cpuemu/index.html">Emulate a 6502</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../keyemu/index.html">Emulate a keyboard</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../viaproto/index.html">VIA prototyping</a>
</li>
<li class="separator">Deprecated boards</li>
<li><div class="i_file">&nbsp;</div><a href="../cpu816/index.html">65816 CPU V1</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../cpu65b/index.html">64k CPU</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../key/index.html">Keyboard and RS232</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../iec/index.html">IEEE488 and CBM IEC</a>
</li>
<li class="separator">Other links</li>
<li><div class="i_file">&nbsp;</div><a href="../gallery/index.html">Gallery</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../emu/index.html">VICE emu of CS/A65</a>
</li>
<li><div class="i_link">&nbsp;</div><a href="../../cbmhw/c64csa/index.html">C64 CS/A adapter</a></li>
<li><div class="i_link">&nbsp;</div><a href="../../cbmhw/petcsa/index.html">PET CS/A adapter</a></li>
</ul>
</li>
<li class="dir" id="m_adv65"><div class="i_dir">&nbsp;</div><a href="../../adv65/index.html">Advanced 6502</a>

</li>
<li class="dir" id="m_hwinfo"><div class="i_dir">&nbsp;</div><a href="../../hwinfo/index.html">ICs and Standards Info</a>

</li>
<li class="dir" id="m_mischw"><div class="i_dir">&nbsp;</div><a href="../../mischw/index.html">Other hardware (e.g. tools)</a>

</li>
<li class="separator">Software</li>
<li><div class="i_file">&nbsp;</div><a href="../../osa/index.html">GeckOS operating system</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../lib6502/index.html">Lib6502 standard</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../o65/index.html">O65 file format</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../usb65/index.html">usb65 USB drivers</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../xd2031/index.html">XD2031 firmware</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../misc/index.html">Misc software</a>
</li>
<li class="separator">Knowledge Bits</li>
<li class="dir" id="m_icapos"><div class="i_dir">&nbsp;</div><a href="../../icapos/index.html">Computer/OS Architecture</a>

</li>
<li class="dir" id="m_icaphw"><div class="i_dir">&nbsp;</div><a href="../../icaphw/index.html">6502 Hardware Bits</a>

</li>
<li class="separator">Misc</li>
<li><div class="i_file">&nbsp;</div><a href="../../contact.html">Contact</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../sneak.html">Sneak preview</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../design.html">Web design</a></li>
</ul>

</div>
		</div><div class="top" id="browser"><div class="tophead">browser</div><div>
			Site has been tested with a number of browsers and systems. Javascript required for advanced menu, but degrades gracefully without Javascript. IE6 not supported anymore!
			</div></div></div><div id="rightcol"><div class="top" id="google"><div class="tophead">search</div><div><form method="get" action="http://www.google.com/search" target="_blank"><input alt="search parameters" type="text" name="q" size="10" maxlength="255" value=""><input class="advbutton" type="submit" value="Search my site"><br>(Google, in new window)
	                        <input type="hidden" name="sitesearch" value="www.6502.org/users/andre"></form></div></div><div class="top" id="share"><div class="tophead">share</div><div><div id="socialshareprivacy"></div></div></div><div class="top" id="twitter"><div class="tophead">follow</div><div>
		            Follow my 8-bit tweets on<br><a class="extlink" target="_blank" href="https://twitter.com/#!/search/realtime/afachat%20%238bit">Twitter</a><br> (In new window)
		</div></div><div class="top" id="forum"><div class="tophead">discuss</div><div><p>Discuss my site on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=956">this 6502.org forum thread</a></p><p>(Forum registration required to post)</p></div></div><div class="top" id="hot"><div class="tophead">Hot!</div><div>
<p>Dive into the retro feeling and build yourself a <a href="../../cbmhw/ryofat40/index.html">Commodore PET replica</a></p>
<p>Need more speed? Speed up your 6502 computer with this <a href="../../adv65/pet816/index.html">10&nbsp;MHz 6502 CPU replacement board</a></p>
<p>Interested in electronics design? Look at the <a href="../../icaphw/design.html">design lesson</a> I got from Bil Herd, the hardware designer of the C128</p>
<p>Want 64bit? - pimp the 6502 with the <a href="../../65k/index.html">65k processor design!</a></p>

		</div></div></div><div id="midcol"><div class="top" id="ie6warn">
You are using an old MS Internet Explorer as browser. This version is not supported anymore. Please use a 
more modern browser, like Internet Explorer 8 or later, 
<a target="_blank" class="extlink" href="http://www.firefox.com">Firefox</a>,
<a target="_blank" class="extlink" href="http://www.google.com/chrome">Google Chrome</a>, or
<a target="_blank" class="extlink" href="http://www.opera.com">Opera</a>.
</div><div class="top" id="content"><div id="minmax"></div>
<div id="breadcrumbs">
<a href="../../index.html">Homepage</a>
&gt;&gt; <a href="../index.html">CS/A65 Caspaer and Gecko computer</a>&gt;&gt;  <a href="index.html">Block transfer
</a>&gt;&gt;  How it works</div>
<h1>Blitter - how it works</h1><p class="copyright">(C)
2007-2011 Andr&eacute;  Fachat</p> 
<div class="overview">
	<p>
	This page explains how the <a href="index.html">CS/A Blitter</a> works.
	</p>
  </div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="news">News:</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><ul class="news"><li><div>&nbsp;</div><small>2010-09-17</small>
	Started this page
    </li></ul></div></div><div id="toc" class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2>Table of content</h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><ul><li><a href="#main">Architecture</a></li><li style="list-style-type:none;"><ul><li><a href="#address">Address Generation</a></li></ul></li><li><a href="#main">Operating Modes</a></li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="main">Architecture</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><p>The blitter architecture is based on a CPU-like architecture. It uses registers
	connected to shared busses, and a single ALU between the busses.</p>
<div><a href="blitter arch.svg"><img src="blitter arch.png" alt="blitter architecture"></a><p>Blitter architecture (click to enlarge)</p></div>
	<p>The main components are:</p>
	<ul>
	<li>Address generation: creates the blitter addresses to read and write
		the data bytes.</li>
	<li>Data transfer register: The register to store the data read in the 
		first transfer cycle, and to provide it in the second cycle</li>
	<li>Counter register: counts down the number of bytes to transfer.
		Also compares the number of bytes to zero, to get an end signal.</li>
	<li>Control: state control, and a logic array to control all the 
		registers and buffers</li>
	</ul>
     <h3><a name="address">Address Generation</a></h3>
<div class="rightimg"><a href="blitter v01.svg"><img src="blitter v01.png" alt="address generation architecture"></a><p>Blitter address generation (click to enlarge)</p></div>
	<p>The address generation components are:</p>
	<ul>
	<li>LDADDR/STADDR: address registers for load and store addresses</li>
	<li>LDINC/STINC: registers for address increment</li>
	<li>ALU: Adder to add the address and the increment</li>
	<li>ZERO: zero increment (see below for the purpose)</li>
	<li>Address data buffer: connects the INBUS to the CPU data bus. Note that this
		is actually three 8-bit buffers, where one byte at a time can be
		accessed (denoted by the "8Bit" in the diagram)</li>
	<li>Increment data buffer: connects the Increment bus to the CPU data bus</li>
	<li>Address buffer: drives the address from OUTBUS to the system address bus</li>
	</ul>
	<p>These components are connected together by three busses:</p>
	<ul>
	<li>INBUS: The INBUS is called that as it feeds a new address value into the
		load and store address registers. The value can come from the 
		ALU output or from the CPU data bus.</li>
	<li>OUTBUS: The outbus holds the output from the load and store address registers.
		Its value is put on the actual address bus during a fetch or store operation.
		The value from this bus is at the same time also fed into one side of the 
		ALU adder.</li>
	<li>Increment: This bus holds the output of the increment registers, resp. the zero increment
		value. Its value is fed into the second ALU adder input, but can also be read
		from the CPU data bus.</li>
	</ul>
	<p>Together these components allow to do the actual data transfer, as well as the address increment
	of the address registers in a single cycle. The same, shared, ALU and bus components are used in 
	both cases, when the data is fetched and when it is stored. This helps to keep the required board space
	small enough.</p>
	<p>The actual circuit also features a control register, that allows to set the adder's carry,
	and the additional bits necessary to extend the increment value to a full address width.
	This for example allows:</p>
	<ul>
	<li>incrementing 256 byte (page): set the carry and use an increment value of $ff</li>
	<li>decrementing: set the carry, use inverse (EOR #$FF) of the value to subtract as 
		increment and set the complement bit (upper increment bits). For example to
		substract by one, set the carry, use $FE as increment value and setting 
		the complement makes the increment to $FFFFE. You can also clear the carry and
		use $FFFFF as increment of course.</li>
	</ul>
     </div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="main">Operating Modes</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><p>This section explains the operating modes of the 
	address generation.
	</p>
	<table border="1" width="100%">
	<tr><th>Mode</th><th>diagram (click to enlarge)</th></tr>
	<tr><td>CPU write address. The CPU data bus is directly fed into the load and
		store address registers via the INBUS</td>
		<td><a href="blitter WRADDR.svg"><img src="blitter WRADDR.png" alt="write address"></a></td>
	</tr>
	<tr><td>CPU read address. Please note that the address is actually taken from the 
		INBUS, which is the output of the ALU, not of the address register.
		If the data bus were connected to the address register output, it would
		require three (for up to 24 address bits) 8-bit drivers. Using the
		ALU output allows to reuse the data bus drivers used to write the address
		registers, and only requires a zero input to the ALU increment input -
		so that the address register value is passed through the ALU unchanged.</td>
		<td><a href="blitter RDADDR.svg"><img src="blitter RDADDR.png" alt="read address"></a></td>
	</tr>
	<tr><td>CPU write increment. Similar to writing the addresses, the increment 
		registers are directly fed from the CPU data bus.</td>
		<td><a href="blitter WRINC.svg"><img src="blitter WRINC.png" alt="write increment"></a></td>
	</tr>
	<tr><td>CPU read increment. To read the increment, a separate read pass-buffer 
		is used. As both increment registers output to the same bus, only a single
		pass-buffer is used for both increment registers.</td>
		<td><a href="blitter RDINC.svg"><img src="blitter RDINC.png" alt="read increment"></a></td>
	</tr>
	<tr><td>Blitter read/write data. The output of the address register is passed 
		through to the system address bus. But this value is also passed to one
		input of the adder ("ALU"). The other input of the adder is fed from the
		increment register. Thus the adder output presents the next value for the
		address register. So at the end of the cycle this new addres is latched
		into the address register.
		</td>
		<td><a href="blitter RD+ST.svg"><img src="blitter RD+ST.png" alt="read/write blitter data"></a></td>
	</tr>
	</table>
     </div></div><hr>
<p>Return to <a href="../../index.html">Homepage</a></p>

  </div></div><div id="footer">&nbsp;</div></div><script type="text/javascript">myUp="../../";</script><script type="text/javascript" src="../../scripts-all.js"></script><script type="text/javascript" src="../../jquery.socialshareprivacy.js"></script><script type="text/javascript">
          jQuery(document).ready(function($){
                  if($('#socialshareprivacy').length != 0){
                            $('#socialshareprivacy').socialSharePrivacy();
                  }
          });
  </script></body></html> 
