<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="author" content="Andr&#xE9;  Fachat" />

<meta name="description" content="6502 block transfer engine" />
<meta name="keywords" content="6502 blitter block transfer engine" />
<link rev="made" href="mailto:afachat@gmx.de" />
<link rel="stylesheet" title="Default" type="text/css" href="../../style-min.css" /><link rel="alternate stylesheet" title="Advanced" type="text/css" href="../../advanced.css" />
<title>Blitter</title></head>
<body><div id="mainbox"><a name="top" id="top"></a><div id="leftcol"><div id="menu" class="top"><div class="tophead">navigate</div><div id="filter"><form action="#"><table id="filterbox"><tr><td><input alt="menu filter" size="8" name="filter" value="filter" type="text" /></td><td><div id="cancel" class="i_cancel"> </div></td></tr></table><table id="expcol"><tr><td><div id="expand" class="i_expand"> </div></td><td><div id="collapse" class="i_collapse"> </div></td></tr></table></form></div>
<div id="mtree">
<a id="m_homepage" href="../../index.html">Homepage</a>
<ul class="menu0" >
<li class="separator">Commodore</li>
<li class="dir" id="m_petindex"><div class="i_dir">&nbsp;</div><a href="../../petindex/index.html">CBM PETindex</a>
</li>
<li class="dir" id="m_cbmhw"><div class="i_dir">&nbsp;</div><a href="../../cbmhw/index.html">CBM hardware and mods</a>
</li>
<li class="separator">Hardware</li>
<li class="dir" id="m_65k"><div class="i_dir">&nbsp;</div><a href="../../65k/index.html">The 65k Project</a>
</li>
<li class="dir" id="m_csa"><div class="i_dir">&nbsp;</div><a href="../../csa/index.html">CS/A65 Caspaer and Gecko computer</a>
<ul class="menu1" >
<li><div class="i_file">&nbsp;</div><a href="../memmap.html">Memory Map</a></li>
<li class="separator">Specifications</li>
<li><div class="i_file">&nbsp;</div><a href="../bus.html">Bus V1.0</a></li>
<li><div class="i_file">&nbsp;</div><a href="../bus-1.1.html">Bus V1.1</a></li>
<li class="separator">Main boards</li>
<li><div class="i_file">&nbsp;</div><a href="../cpu/index.html">CS/A65 CPU</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../bios/index.html">CS/A65 BIOS </a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../cpu816v2/index.html">65816 CPU V2</a>
</li>
<li class="dir" id="m_csa_petcpu"><div class="i_dir">&nbsp;</div><a href="../petcpu/index.html">64k PET CPU</a>
</li>
<li class="dir" id="m_csa_gecko"><div class="i_dir">&nbsp;</div><a href="../gecko/index.html">Gecko</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../auxcpu/index.html">Auxiliary CPU</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../pwr/index.html">Power Supply</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../term/index.html">Bus terminators</a>
</li>
<li class="separator">I/O boards</li>
<li><div class="i_file">&nbsp;</div><a href="../vdc/index.html">Video board</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../petio/index.html">CBM PET I/O</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../etholi/index.html">Ethernet</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../usb/index.html">USB</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../shug/index.html">PC floppy</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../drvio/index.html">DRVIO floppy and IEC</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../duart/index.html">Double UART (RS232)</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../scsi/index.html">SCSI/I2C board</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../spi/index.html">MMC/SD-Card</a>
</li>
<li class="separator">Special purpose</li>
<li><div class="i_file">&nbsp;</div><a href="index.html" class="mcurrent">Block transfer</a>
<ul class="menu2" >
<li><div class="i_file">&nbsp;</div><a href="works.html">How it works</a></li>
</ul>
</li>
<li><div class="i_file">&nbsp;</div><a href="../ramdisk/index.html">SIMM RAMDisk</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../copro/index.html">Coprocessor board</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../cpuemu/index.html">Emulate a 6502</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../keyemu/index.html">Emulate a keyboard</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../viaproto/index.html">VIA prototyping</a>
</li>
<li class="separator">Deprecated boards</li>
<li><div class="i_file">&nbsp;</div><a href="../cpu816/index.html">65816 CPU V1</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../cpu65b/index.html">64k CPU</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../key/index.html">Keyboard and RS232</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../iec/index.html">IEEE488 and CBM IEC</a>
</li>
<li class="separator">Other links</li>
<li><div class="i_file">&nbsp;</div><a href="../gallery/index.html">Gallery</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../emu/index.html">VICE emu of CS/A65</a>
</li>
<li><div class="i_link">&nbsp;</div><a href="../../cbmhw/c64csa/index.html">C64 CS/A adapter</a></li>
<li><div class="i_link">&nbsp;</div><a href="../../cbmhw/petcsa/index.html">PET CS/A adapter</a></li>
</ul>
</li>
<li class="dir" id="m_adv65"><div class="i_dir">&nbsp;</div><a href="../../adv65/index.html">Advanced 6502</a>
</li>
<li class="dir" id="m_hwinfo"><div class="i_dir">&nbsp;</div><a href="../../hwinfo/index.html">ICs and Standards Info</a>
</li>
<li class="dir" id="m_mischw"><div class="i_dir">&nbsp;</div><a href="../../mischw/index.html">Other hardware (e.g. tools)</a>
</li>
<li class="separator">Software</li>
<li><div class="i_file">&nbsp;</div><a href="../../osa/index.html">GeckOS operating system</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../lib6502/index.html">Lib6502 standard</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../o65/index.html">O65 file format</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../misc/index.html">Misc software</a>
</li>
<li class="separator">Knowledge Bits</li>
<li class="dir" id="m_icapos"><div class="i_dir">&nbsp;</div><a href="../../icapos/index.html">Computer/OS Architecture</a>
</li>
<li class="dir" id="m_icaphw"><div class="i_dir">&nbsp;</div><a href="../../icaphw/index.html">6502 Hardware Bits</a>
</li>
<li class="separator">Misc</li>
<li><div class="i_file">&nbsp;</div><a href="../../contact.html">Contact</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../sneak.html">Sneak preview</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../design.html">Web design</a></li>
</ul>

</div>
		</div><div class="top" id="browser"><div class="tophead">browser</div><div>
			Site has been tested with a number of browsers and systems. Javascript required for advanced menu, but degrades gracefully without Javascript. IE6 not fully supported anymore!
			</div></div></div><div id="rightcol"><div class="top" id="google"><div class="tophead">search</div><div><form method="get" action="http://www.google.com/search" target="_blank"><input alt="search parameters" type="text" name="q" size="10" maxlength="255" value="" /><input class="advbutton" type="submit" value="Search my site" /><br />(Google, in new window)
	                        <input type="hidden" name="sitesearch" value="www.6502.org/users/andre" /></form></div></div><div class="top" id="twitter"><div class="tophead">follow</div><div>
		            Follow my 8-bit tweets on<br /><a target="_blank" href="http://search.twitter.com/search?q=&amp;ands=&amp;phrase=&amp;ors=&amp;nots=&amp;tag=8bit&amp;lang=all&amp;from=afachat&amp;to=&amp;ref=&amp;near=&amp;within=15&amp;units=mi&amp;since=&amp;until=&amp;rpp=15">Twitter</a><br /> (In new window)
		</div></div><div class="top" id="forum"><div class="tophead">discuss</div><div><p>Discuss my site on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=956">this 6502.org forum thread</a></p><p>(Forum registration required to post)</p></div></div><div class="top" id="hot"><div class="tophead">Hot!</div><div>
<p>Dive into the retro feeling and build yourself a <a href="../../cbmhw/ryofat40/index.html">Commodore PET replica</a></p>
<p>Need more speed? Speed up your 6502 computer with this <a href="../../adv65/pet816/index.html">10&nbsp;MHz 6502 CPU replacement board</a></p>
<p>Interested in electronics design? Look at the <a href="../../icaphw/design.html">design lesson</a> I got from Bil Herd, the hardware designer of the C128</p>
<p>Want 64bit? - pimp the 6502 with the <a href="../../65k/index.html">65k processor design!</a></p>

		</div></div></div><div id="midcol"><div class="top" id="ie6warn">
You are using an old MS Internet Explorer as browser. This version is not supported anymore. Please use a 
more modern browser, like Internet Explorer 8 or later, 
<a target="_blank" class="extlink" href="http://www.firefox.com">Firefox</a>,
<a target="_blank" class="extlink" href="http://www.google.com/chrome">Google Chrome</a>, or
<a target="_blank" class="extlink" href="http://www.opera.com">Opera</a>.
</div><div class="top" id="content"><div id="minmax"></div>
<div id="breadcrumbs">
<a href="../../index.html">Homepage</a>
&gt;&gt; <a href="../index.html">CS/A65 Caspaer and Gecko computer</a>&gt;&gt;  Block transfer</div>
<h1>Blitter</h1><p class="copyright">(C)
2007-2010 André  Fachat</p> 
<div class="overview"><p>Transfering a block of bytes from one memory location to another
	using the CPU can take a lot of time. A simple transfer loop using absolute
	addressing uses about 13 cycles per byte. Using zeropage indexed addressing 
	it takes even more. That is the reason why computers like the Amiga or the
	later Atari ST have block transfer engines, or PCs have DMA engines in the chipset.
	The 65816 chip even includes special opcodes to do block transfers, with a rate 
	of seven cycles per byte.
	</p><p>
	I thought I should add a block tranfer engine to the CS/A system. 
	Back then in 2007 I did a first design - and utterly failed. It implemented
	two address registers, with a separate adder/incrementer and buffers for each address,
	so it took a whole lot of board space, so I wasn't able to actually place and 
	route it. You can see the design below as V1.
	</p><p>
	In 2010 I had a better look into CPU architectures, and I got the idea that
	I could build a blitter using something similar to a CPU architecture. Using 
	an architecture with address registers, shared busses, and a single ALU I was
	able to produce a new design (see V2 below) that does not need as much board
	space and that I was able to place and route with SMD technology.
	</p><p>
	In the <a href="works.html">How it works</a> page I have described how the
	board works in principle.
	</p>
  </div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="news" id="news">News:</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><ul class="news"><li><div> </div><small>2010-09-17</small>
	Started this page
    </li></ul></div></div><div id="toc" class="h2"><div class="h2h"><div class="h2t"> </div><h2>Table of content</h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><ul><li><a href="#desc">Board description</a></li><li style="list-style-type:none;"><ul><li><a href="#dbus">Data Bus Separation</a></li><li><a href="#logic">Logic Implementation</a></li><li><a href="#layout">Layout description</a></li></ul></li><li><a href="#boards">Board Revisions</a></li><li style="list-style-type:none;"><ul><li><a href="#board1">2.1A</a> (prototype)</li><li><a href="#board2">1.0B</a> (not working)</li></ul></li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="desc" id="desc">Board description</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><p>In the <a href="works.html">How it works</a> page the principles of operation
	are described. Here I'll describe some of the implementation details (of the V2 board).
     </p><h3><a name="dbus" id="dbus">Data Bus Separation</a></h3><p>
	In the principles the CPU data bus is connected to the INBUS drivers, the increment
	registers, the increment data buffer, and - not shown there - to the input as well as output
	of the data transfer register (where the transferred data is kept). This would put a lot
	of load on the actual CPU data bus. Therefore I added IC15, a data bus driver that separates
	the actual CPU data bus from the board data bus.
	</p><h3><a name="logic" id="logic">Logic Implementation</a></h3><p>
	The system actually only as a few bits of "state" if you don't count the address and increment
	registers. It must know if it is active, and when active it needs to know which operation it
	is doing - fetch or store. This state is defined in the signals /ACTIVE and FETCH/-STORE.
	In the 2.0 version these bits were determined by some RS-Flipflops, and all other logic
	was derived from that and implemented in two PAL chips. But my PAL burner is not that 
	reliable and I had a Xilinx 9536 CPLD around, so I decided to move everything into the CPLD
	- which is shown in the 2.1 version. Unfortunately the CPLD is about a few lines short of
	being able to include all the logic. So some small parts are still implemented as inverters
	and AND gates.
	</p><p>
	Note that the 2.1 board contains some "PIN" pads, to be able to easily use the remaining logic
	gates even though these chips are SMD...
	</p><h3><a name="layout" id="layout">Layout description</a></h3><p>
	If you look at the layout, it is dominated by an five-by-four array of SOW20 chips with some
	smaller chips to the right. These implement the INBUS, OUTBUS and Increment busses as follows:
	</p><p>
	The first line of chips implements the Increment bus, with two '574 as increment value registers
	for fetch and store. Then there is IC24 ('245) to read out the increment bus, and IC23 ('245)
	to feed a zero increment into the adder.
	</p><p>
	To the right of that comes IC32 ('245) and IC25/IC28 (both '193) that implement the transfer counter.
	</p><p>
	The next three lines of ICs implement the address bits 0-7, 8-15 and 16-19 respectively, including
	their part of the INBUS and OUTBUS busses. First comes the address drivers that are used to
	drive the OUTBUS to the CPU address bus. Then there are the two '574 that hold the fetch and store
	address values; then there is the data bus driver, connecting the INBUS with the CPU data bus.
	The right-most 20-pin chip is the ALU output driver, that drives the adder output onto the
	INBUS. The smaller chips to the right are '293 4-bit adders, implementing the actually "ALU" adder.
	</p></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="boards" id="boards">Board revisions</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><h3><a name="board1" id="board1">Version: 2.1A</a></h3>
<p>Status: prototype</p>
<h4>Notes</h4><table class="notes"><tr><td class="noteicon"><div class="i_stop"> </div></td>
<td>
			This board is a prototype design that I still have to build and test!
                </td></tr>
</table><h4>Files</h4><table class="files">
<tr class="R1"><td><div class="i_schem"> </div></td>
<td><a href="csa_blitter-v2.1a.sch">csa_blitter-v2.1a.sch</a></td>
</tr>
<tr class="R0"><td><div class="i_schem"> </div></td>
<td><a href="csa_blitter-v2.1a-sch.png">csa_blitter-v2.1a-sch.png</a></td>
</tr>
<tr class="R1"><td><div class="i_layout"> </div></td>
<td><a href="csa_blitter-v2.1a.brd">csa_blitter-v2.1a.brd</a></td>
</tr>
<tr class="R0"><td><div class="i_layout"> </div></td>
<td><a href="csa_blitter-v2.1a-brd.png">csa_blitter-v2.1a-brd.png</a></td>
</tr></table>
<h3><a name="board2" id="board2">Version: 1.0B</a></h3>
<p>Status: not working</p>
<h4>Notes</h4><table class="notes"><tr><td class="noteicon"><div class="i_stop"> </div></td>
<td>
			This is an example of how not to do it. The schematics sport an own 
			adder resp. incrementer for each address, load and store, and the increment value.
			The board layout shows why I decided to start from scratch - no way to route this
			on a two-layer Eurocard PCB. 
                </td></tr>
<tr><td class="noteicon"><div class="i_msg"> </div></td>
<td>
			The board was supposed to have a daughter board with exchangeable logic 
			to implement transparent DMA - hiding the DMA accesses in the bogus cycles
			between the valid CPU access cycles. That's what the TDMA connector was for.
			Looking at the discussions about how the CPU handles interrupts (they start
			after the opcode fetch, so you'd have to monitor either writes or the interrupt
			line as well) I decided to skip this feature. This also removed the need to
			read the counter register.
		</td></tr>
</table><h4>Files</h4><table class="files">
<tr class="R1"><td><div class="i_schem"> </div></td>
<td><a href="csa_blitter-v1.0b.sch">csa_blitter-v1.0b.sch</a></td>
</tr>
<tr class="R0"><td><div class="i_schem"> </div></td>
<td><a href="csa_blitter-v1.0b-sch.png">csa_blitter-v1.0b-sch.png</a></td>
</tr>
<tr class="R1"><td><div class="i_layout"> </div></td>
<td><a href="csa_blitter-v1.0b-brd.png">csa_blitter-v1.0b-brd.png</a></td>
</tr></table>
</div></div><hr />
<p>Return to <a href="../../index.html">Homepage</a></p>

  </div></div><div id="footer"> </div></div><script type="text/javascript">myUp="../../";</script><script type="text/javascript" src="../../scripts-all.js"></script></body></html> 

