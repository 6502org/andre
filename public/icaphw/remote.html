<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="author" content="Andr&#xE9;  Fachat" />

<meta name="description" content="Remote control via Infrared" />
<meta name="keywords" content="Commodore 6502 remote_control" />
<link rev="made" href="mailto:afachat@gmx.de" />
<link rel="stylesheet" title="Default" type="text/css" href="../style-min.css" /><link rel="alternate stylesheet" title="Advanced" type="text/css" href="../advanced.css" />
<title>Remote control via Infrared</title></head>
<body><div id="mainbox"><div id="leftcol"><div id="menu" class="top"><div class="tophead">navigate</div><div id="filter"><form action="#"><table id="filterbox"><tr><td><input alt="menu filter" size="8" name="filter" value="filter" type="text" /></td><td><div id="cancel" class="i_cancel"> </div></td></tr></table><table id="expcol"><tr><td><div id="expand" class="i_expand"> </div></td><td><div id="collapse" class="i_collapse"> </div></td></tr></table></form></div>
<div id="mtree">
<a id="m_homepage" href="../index.html">Homepage</a>
<ul class="menu0" >
<li class="separator">Commodore</li>
<li class="dir" id="m_petindex"><div class="i_dir">&nbsp;</div><a href="../petindex/index.html">CBM PETindex</a>
</li>
<li class="dir" id="m_cbmhw"><div class="i_dir">&nbsp;</div><a href="../cbmhw/index.html">CBM hardware and mods</a>
</li>
<li class="separator">Hardware</li>
<li class="dir" id="m_csa"><div class="i_dir">&nbsp;</div><a href="../csa/index.html">CS/A65 Caspaer and Gecko computer</a>
</li>
<li class="dir" id="m_adv65"><div class="i_dir">&nbsp;</div><a href="../adv65/index.html">Advanced 6502</a>
</li>
<li class="dir" id="m_hwinfo"><div class="i_dir">&nbsp;</div><a href="../hwinfo/index.html">ICs and Standards Info</a>
</li>
<li class="dir" id="m_mischw"><div class="i_dir">&nbsp;</div><a href="../mischw/index.html">Other hardware (e.g. tools)</a>
</li>
<li class="separator">Software</li>
<li><div class="i_file">&nbsp;</div><a href="../osa/index.html">GeckOS operating system</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../lib6502/index.html">Lib6502 standard</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../o65/index.html">O65 file format</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../misc/index.html">Misc software</a>
</li>
<li class="separator">Knowledge Bits</li>
<li class="dir" id="m_icapos"><div class="i_dir">&nbsp;</div><a href="../icapos/index.html">Computer/OS Architecture</a>
</li>
<li class="dir" id="m_icaphw"><div class="i_dir">&nbsp;</div><a href="../icaphw/index.html">6502 Hardware Bits</a>
<ul class="menu1" >
<li><div class="i_file">&nbsp;</div><a href="design.html">Hardware design lesson</a></li>
<li><div class="i_file">&nbsp;</div><a href="oscope/index.html">Oscilloscope bits</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="xilinx.html">Xilinx CPLD tools</a></li>
<li><div class="i_file">&nbsp;</div><a href="c64ser.html">UART serial interface</a></li>
<li><div class="i_file">&nbsp;</div><a href="rdy.html">RDY generation</a></li>
<li><div class="i_file">&nbsp;</div><a href="remote.html" class="mcurrent">Infrared remote control</a></li>
</ul>
</li>
<li class="separator">Misc</li>
<li><div class="i_file">&nbsp;</div><a href="../contact.html">Contact</a></li>
<li><div class="i_file">&nbsp;</div><a href="../sneak.html">Sneak preview</a></li>
<li><div class="i_file">&nbsp;</div><a href="../design.html">Web design</a></li>
</ul>

</div>
		</div><div class="top" id="browser"><div class="tophead">browser</div><div>
			Site has been tested with a number of browsers and systems. Javascript required for advanced menu, but degrades gracefully without Javascript. IE6 not fully supported anymore!
			</div></div></div><div id="rightcol"><div class="top" id="google"><div class="tophead">search</div><div><form method="get" action="http://www.google.com/search" target="_blank"><input alt="search parameters" type="text" name="q" size="10" maxlength="255" value="" /><input class="advbutton" type="submit" value="Search my site" /><br />(Google, in new window)
	                        <input type="hidden" name="sitesearch" value="www.6502.org/users/andre" /></form></div></div><div class="top" id="twitter"><div class="tophead">follow</div><div>
		            Follow my 8-bit tweets on<br /><a target="_blank" href="http://search.twitter.com/search?q=&amp;ands=&amp;phrase=&amp;ors=&amp;nots=&amp;tag=8bit&amp;lang=all&amp;from=afachat&amp;to=&amp;ref=&amp;near=&amp;within=15&amp;units=mi&amp;since=&amp;until=&amp;rpp=15">Twitter</a><br /> (In new window)
		</div></div><div class="top" id="forum"><div class="tophead">discuss</div><div><p>Discuss my site on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=956">this 6502.org forum thread</a></p><p>(Forum registration required to post)</p></div></div><div class="top" id="hot"><div class="tophead">Hot!</div><div>
<p>Dive into the retro feeling and build yourself a <a href="../cbmhw/ryofat40/index.html">Commodore PET replica</a></p>
<p>Need more speed? Speed up your 6502 computer with this <a href="../adv65/pet816/index.html">10&nbsp;MHz 6502 CPU replacement board</a></p>
<p>Interested in electronics design? Look at the <a href="../icaphw/design.html">design lesson</a> I got from Bil Herd, the hardware designer of the C128</p>

		</div></div></div><div id="midcol"><div class="top" id="ie6warn">
You are using an old MS Internet Explorer as browser. This version is not supported anymore. Please use a 
more modern browser, like Internet Explorer 8 or later, 
<a target="_blank" class="extlink" href="http://www.firefox.com">Firefox</a>,
<a target="_blank" class="extlink" href="http://www.google.com/chrome">Google Chrome</a>, or
<a target="_blank" class="extlink" href="http://www.opera.com">Opera</a>.
</div><div class="top" id="content">
<div id="breadcrumbs">
<a href="../index.html">Homepage</a>
&gt;&gt;  <a href="index.html">6502 Hardware Bits
</a>&gt;&gt;  Infrared remote control</div>
<a name="topanchor" id="topanchor"></a><h1>Remote control via Infrared</h1><p class="copyright">(C)
1997-2010 André  Fachat</p> 
<div class="overview"><p>Who doesn't have the problem of a lot of remote controls for the VCR,
the TV set, the CD player etc lying around on the table?
Well, in 1990 I thought about that and implemented an infrared
remote control feature in my selfbuilt 6502 system. And here is
the description.
</p><p>
Note: This article originally is from 1997 or 1998. Today I would look
into a solution with the NE555 timer chip to generate the actually 38k
infrared frequency.
	</p>
  </div><div id="toc"><h2>Table of content</h2><div class="toplink"><a href="#top">Top</a></div><ul><li><a href="#theory">Theory</a></li><li><a href="#hw">Hardware</a></li><li><a href="#sw">Software</a></li><li><a href="#conclusion">Conclusion</a></li><li><a href="#refs">References</a></li></ul></div><h2><a name="theory" id="theory">Theory</a></h2><div class="toplink"><a href="#top">Top</a></div><p>
How do these infrared remote controls work? Well, they send signals
via infrared using Pulse Code Modulation. That means they send data
bits by different pulse lengths. The infrared light is transmitted by
infrared diodes. But to allow better detection, the infared diodes don't
get a simple current but a 40 kHz signal. So direct current distortions
(from e.g. human bodies emitting infrared!) can easily be filtered out.
</p><p>
After that, some kind of asynchronous data protocol follows. I have a
TV set from a german company named Universum, and a Sony Receiver and
a Sony CD player. A friend had an infrared receiver, so we monitored
the signals of the different remote controls on an oscilloscope.
</p><p>
A signal normally begins with a start bit of fixed length. With the
Universum TV set, the length of the break that follows determines if
it is a "0" or "1" data bit. After the break, a single puls follows
to start the next bit. This code has 6 bit.
The Sony stuff is different, it has twelve bit. Here the signal starts
with a real start bit. Then there is a fixed-length break before each
bit. The length of the following pulse determines if it is a "0" or
"1" data bit.
</p>
<img src="remote/signal.gif" alt="infrared signals" />
<p>Fig. 1 shows the two signals in detail.</p>
<p>
It can be seen that the the signals are relatively simple and
the timing is not very critical.
</p>
    <h2><a name="hw" id="hw">Hardware</a></h2><div class="toplink"><a href="#top">Top</a></div> <p>
The hardware I used is, in general, the 6522 VIA versatile interface adapter
and its timer. The VIA can produce pulse and toggle outputs on timer underruns
on pins PB6 and PB7. The timers count the system clock Phi2, which has
1 or 2 MHz on my selfbuilt computer. The timer values must be set
appropriately, of course.
</p><p>
A timer in the 6522 consists of a timer count register and a latch
register. When an underflow occurs, the content of the latch register
is loaded into the count register. Then the value of the count register
is decremented with the system clock, until the next underflow occurs.
The output line PB7 can be set to toggle when a timer 1 underflow
occurs.
</p><p>
Fig. 2 shows the circuit used to produce the infrared signal. It is
actually not what I would call a clean design of an oscillator, but at
that time I didn't know about the 555 or other stuff...  The output PB7
is inverted first. When the 6522 is reset, then PB7 is set as input,
thus the next gate will most probably read a high signal - disabling
the infrared signal.  The 74LS13 (NAND with built-in Schmitt-Trigger),
together with the 180 Ohm resitor and the 100 nF capacity make up the
40kHz oscillator. The values are hand-optimized (well, I looked at
the oscilloscope and changed the resistor to get the right frequency.
This is definitely _not_ the right way to design such a thing. It worked
for me for this circuit with these resistor values twice, but that's no
guarantee. You are warned!)
</p><p>
The inverted PB7 is given to the NAND, such that a high on PB7 disables
the oscillator. The output is then given to one driver, that outputs it
to the LED drivers. The LED drivers then pull the anode of the LEDs low,
and produce a current that makes them send.
</p>
    <h2><a name="sw" id="sw">Software</a></h2><div class="toplink"><a href="#top">Top</a></div> <p>
The software is pretty simple. In Listing 1. a small menu driven program
is listed that can send remote commands. The first part is all the menu
stuff. Only the last part (sendsony) handles the transmission of the
infrared commands.
</p><p>
When initialized (initir) the line PB7 is set to high output, interrupts
from timer 1 are disabled and PB7 is disabled in the 6522 auxiliary
control register.  When a message is to be sent (sendsony), PB7 is set
to toggle output, and timer 1 is started. PB7 is toggled automatically
when T1 is started, so that the first timer value loaded is the length
of the start bit.  Immediately after that the timer latches are loaded
with the length of the first break. The timer is loaded with the break
time when an underflow occurs at the end of the start bit. At this time
PB7 is also toggled automatically, disabling the oscillator output.
This is also checked by the software, and then the timer value for the
next bit is loaded into the latches. This way the latches always contain
the timer value for the next phase, while the actual phase is counting.
</p><p>
The software has enough time to reload the latches then. Well, enough
time is relative. I tried it as an interrupt device in my 6502
operating system, such that each bit toggle issued an interrupt to
reload the latches. But the interrupt latency was too high to allow
such an operation.
</p>
    <h2><a name="conclusion" id="conclusion">Conclusion</a></h2><div class="toplink"><a href="#top">Top</a></div> <p>
Together with a simple keyboard interface this circuitry allows to
replace remote controls. But it also allows to control TV sets, or VCRs or
other infrared controlled stuff using a (selfbuilt)
computer.
</p><p>
The same circuitry, together with a modified version of the listed
program, is implemented in the CS/A65 Gecko computer, a simple
6502 prototype board. Have a look at it at the <a href="../csa/gecko/index.html">Gecko page</a>
</p>
    <h2><a name="refs" id="refs">References</a></h2><div class="toplink"><a href="#top">Top</a></div> <ul>
<li><a href="remote/irtx.a65">irtx.a65</a> driver source code</li>
<li><a href="remote/irtx.def">irtx.def</a> remote signal definitions</li>
<li><a href="remote/diagram.gif">diagram.gif</a> schematics (<a href="remote/diagram.fig">source</a>)</li>
<li><a href="remote/signal.gif">signal.gif</a> remote signal description (<a href="remote/signal.fig">source</a>)</li>
</ul>
    <hr />
<p>Return to <a href="../index.html">Homepage</a></p>

  </div></div><div id="footer"> </div></div><script type="text/javascript">myUp="../";</script><script type="text/javascript" src="../scripts-all.js"></script></body></html> 

