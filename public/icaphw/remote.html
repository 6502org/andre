<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />
<meta name="author" content="Andr&#xE9;  Fachat" />

<meta name="description" content="Remote control via Infrared" />
<meta name="keywords" content="Commodore 6502 remote_control" />
<link rev="made" href="mailto:afachat@gmx.de" />
<link rel="stylesheet" title="Default" type="text/css" href="../style2-min.css" /><link href="../shariff.complete.css" rel="stylesheet" />
<title>Remote control via Infrared</title></head>
<body><div id="mainbox"><a name="top" id="top"></a><div id="topsearch"><form method="get" action="http://www.google.com/search" target="_blank" autocomplete="off"><input id="searchinput" alt="search" name="q" size="10" maxlength="255" type="text" value="" /><input class="advbutton" value="Search site" type="submit" /><div id="srchprov">(by Google)</div><input name="sitesearch" value="www.6502.org/users/andre" type="hidden" /></form><div id="topfind"><div id="topprogress"></div></div></div><div id="menubox">


<div id="menu1" class="mclose">
<div id="twist1" class="twisty"></div>
<div class="hdrtxt"><a href="../index.html">Home&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="../index.html">Home</a></li>
<li><a href="../contact.html">Contact</a></li>
<li><a href="../design.html">Web design</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Hardware</span></li>
<li><ul class="nav2" >
<li><a href="../65k/index.html">The 65k Project</a>
</li>
<li><a href="../pet816/index.html">PET816 Accelerator</a>
</li>
<li><a href="../csa/index.html">CS/A65</a>
</li>
<li><a href="../cbmhw/index.html">CBM mods</a>
</li>
<li><a href="../spi65b/index.html">SPI65B</a>
</li>
<li><a href="../mischw/index.html">Other hardware</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Software</span></li>
<li><ul class="nav2" >
<li><a href="../osa/index.html">GeckOS</a>
</li>
<li><a href="../lib6502/index.html">lib6502 </a>
</li>
<li><a href="../o65/index.html">o65</a>
</li>
<li><a href="../usb65/index.html">usb65</a>
</li>
<li><a href="../xd2031/index.html">XD2031</a>
</li>
<li><a href="../misc/index.html">Misc</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Library</span></li>
<li><ul class="nav2" >
<li><a href="../petindex/index.html">PETindex</a>
</li>
<li><a href="../petindex/drives/index.html">PET drives</a>
</li>
<li><a href="../adv65/index.html">Advanced 6502</a>
</li>
<li><a href="../hwinfo/index.html">ICs and Standards</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Knowledge Bits</span></li>
<li><ul class="nav2" >
<li><a href="../icapos/index.html">Computer/OS Architecture</a>
</li>
<li><a href="../icaphw/index.html">6502 Hardware Bits</a>
</li>
<li><a href="../emulation/index.html">Emulation</a>
</li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
<div id="menu2" class="mopen">
<div id="twist2" class="twisty"></div>
<div class="hdrtxt"><a href="index.html">Hardware Bits&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="index.html">Hardware Bits</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Basics</span></li>
<li><ul class="nav2" >
<li><a href="design.html">Hardware design lesson</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Tools</span></li>
<li><ul class="nav2" >
<li><a href="oscope/index.html">Oscilloscope bits</a>
</li>
<li><a href="xilinx.html">Xilinx CPLD tools</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Interfaces</span></li>
<li><ul class="nav2" >
<li><a href="c64ser.html">UART serial interface</a></li>
<li><a href="remote.html">Infrared remote control</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Misc</span></li>
<li><ul class="nav2" >
<li><a href="rdy.html">RDY generation</a></li>
<li><a href="../csa/blitter/works.html">&gt;How a Blitter works</a></li>
<li><a href="../petindex/poke/index.html">&gt;The PET Killer Poke</a></li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
	</div><div id="midcol"><div class="top" id="content"><div id="minmax"></div>

<h1>Remote control via Infrared</h1><p class="copyright">(C)
1997-2010 André  Fachat</p> 
<div class="overview"><p>Who doesn't have the problem of a lot of remote controls for the VCR,
the TV set, the CD player etc lying around on the table?
Well, in 1990 I thought about that and implemented an infrared
remote control feature in my selfbuilt 6502 system. And here is
the description.
</p><p>
Note: This article originally is from 1997 or 1998. Today I would look
into a solution with the NE555 timer chip to generate the actually 38k
infrared frequency.
	</p>
  </div><div id="toc" class="h2"><div class="h2h"><div class="h2t"> </div><h2>Table of content</h2></div><div class="h2c"><ul><li><a href="#theory">Theory</a></li><li><a href="#hw">Hardware</a></li><li><a href="#sw">Software</a></li><li><a href="#conclusion">Conclusion</a></li><li><a href="#refs">References</a></li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="theory" id="theory">Theory</a></h2></div><div class="h2c"><p>
How do these infrared remote controls work? Well, they send signals
via infrared using Pulse Code Modulation. That means they send data
bits by different pulse lengths. The infrared light is transmitted by
infrared diodes. But to allow better detection, the infared diodes don't
get a simple current but a 40 kHz signal. So direct current distortions
(from e.g. human bodies emitting infrared!) can easily be filtered out.
</p><p>
After that, some kind of asynchronous data protocol follows. I have a
TV set from a german company named Universum, and a Sony Receiver and
a Sony CD player. A friend had an infrared receiver, so we monitored
the signals of the different remote controls on an oscilloscope.
</p><p>
A signal normally begins with a start bit of fixed length. With the
Universum TV set, the length of the break that follows determines if
it is a "0" or "1" data bit. After the break, a single puls follows
to start the next bit. This code has 6 bit.
The Sony stuff is different, it has twelve bit. Here the signal starts
with a real start bit. Then there is a fixed-length break before each
bit. The length of the following pulse determines if it is a "0" or
"1" data bit.
</p>
<img src="remote/signal.gif" alt="infrared signals" />
<p>Fig. 1 shows the two signals in detail.</p>
<p>
It can be seen that the the signals are relatively simple and
the timing is not very critical.
</p>
    </div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="hw" id="hw">Hardware</a></h2></div><div class="h2c"> <p>
The hardware I used is, in general, the 6522 VIA versatile interface adapter
and its timer. The VIA can produce pulse and toggle outputs on timer underruns
on pins PB6 and PB7. The timers count the system clock Phi2, which has
1 or 2 MHz on my selfbuilt computer. The timer values must be set
appropriately, of course.
</p><p>
A timer in the 6522 consists of a timer count register and a latch
register. When an underflow occurs, the content of the latch register
is loaded into the count register. Then the value of the count register
is decremented with the system clock, until the next underflow occurs.
The output line PB7 can be set to toggle when a timer 1 underflow
occurs.
</p><p>
Fig. 2 shows the circuit used to produce the infrared signal. It is
actually not what I would call a clean design of an oscillator, but at
that time I didn't know about the 555 or other stuff...  The output PB7
is inverted first. When the 6522 is reset, then PB7 is set as input,
thus the next gate will most probably read a high signal - disabling
the infrared signal.  The 74LS13 (NAND with built-in Schmitt-Trigger),
together with the 180 Ohm resitor and the 100 nF capacity make up the
40kHz oscillator. The values are hand-optimized (well, I looked at
the oscilloscope and changed the resistor to get the right frequency.
This is definitely _not_ the right way to design such a thing. It worked
for me for this circuit with these resistor values twice, but that's no
guarantee. You are warned!)
</p><p>
The inverted PB7 is given to the NAND, such that a high on PB7 disables
the oscillator. The output is then given to one driver, that outputs it
to the LED drivers. The LED drivers then pull the anode of the LEDs low,
and produce a current that makes them send.
</p>
    </div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="sw" id="sw">Software</a></h2></div><div class="h2c"> <p>
The software is pretty simple. In Listing 1. a small menu driven program
is listed that can send remote commands. The first part is all the menu
stuff. Only the last part (sendsony) handles the transmission of the
infrared commands.
</p><p>
When initialized (initir) the line PB7 is set to high output, interrupts
from timer 1 are disabled and PB7 is disabled in the 6522 auxiliary
control register.  When a message is to be sent (sendsony), PB7 is set
to toggle output, and timer 1 is started. PB7 is toggled automatically
when T1 is started, so that the first timer value loaded is the length
of the start bit.  Immediately after that the timer latches are loaded
with the length of the first break. The timer is loaded with the break
time when an underflow occurs at the end of the start bit. At this time
PB7 is also toggled automatically, disabling the oscillator output.
This is also checked by the software, and then the timer value for the
next bit is loaded into the latches. This way the latches always contain
the timer value for the next phase, while the actual phase is counting.
</p><p>
The software has enough time to reload the latches then. Well, enough
time is relative. I tried it as an interrupt device in my 6502
operating system, such that each bit toggle issued an interrupt to
reload the latches. But the interrupt latency was too high to allow
such an operation.
</p>
    </div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="conclusion" id="conclusion">Conclusion</a></h2></div><div class="h2c"> <p>
Together with a simple keyboard interface this circuitry allows to
replace remote controls. But it also allows to control TV sets, or VCRs or
other infrared controlled stuff using a (selfbuilt)
computer.
</p><p>
The same circuitry, together with a modified version of the listed
program, is implemented in the CS/A65 Gecko computer, a simple
6502 prototype board. Have a look at it at the <a href="../csa/gecko/index.html">Gecko page</a>
</p>
    </div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="refs" id="refs">References</a></h2></div><div class="h2c"> <ul>
<li><a href="remote/irtx.a65">irtx.a65</a> driver source code</li>
<li><a href="remote/irtx.def">irtx.def</a> remote signal definitions</li>
<li><a href="remote/diagram.gif">diagram.gif</a> schematics (<a href="remote/diagram.fig">source</a>)</li>
<li><a href="remote/signal.gif">signal.gif</a> remote signal description (<a href="remote/signal.fig">source</a>)</li>
</ul>
    </div></div><hr />
<p>Return to <a href="../index.html">Homepage</a></p>

  Last modified: 
2011-12-23
	</div></div><div id="rightcol"><div class="top" id="share"><div class="tophead">share</div><div><div class="shariff" data-backend-url="https://fachat-shariff-backend.eu-gb.mybluemix.net/" data-theme="grey" data-orientation="vertical"></div></div></div><div class="top" id="twitter"><div class="tophead">follow</div><div><p>Follow my 8-bit tweets on
		            <a class="extlink" target="_blank" href="https://twitter.com/#!/search/realtime/afachat%20%238bit">Twitter</a> (In new window)</p></div></div><div class="top" id="forum"><div class="tophead">discuss</div><div><p>Discuss my site on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=956">this 6502.org forum thread</a></p><p>(Forum registration required to post)</p></div></div><div class="top" id="hot"><div class="tophead">hot!</div><div>
<p>Dive into the retro feeling and build yourself a <a href="../cbmhw/ryofat40/index.html">Commodore PET replica</a></p>
<p>Need more speed? Speed up your 6502 computer with this <a href="../pet816/index.html">10&nbsp;MHz 6502 CPU accelerator board</a></p>
<p>Interested in electronics design? Look at the <a href="../icaphw/design.html">design lesson</a> I got from Bil Herd, the hardware designer of the C128</p>
<p>Want 64bit? - pimp the 6502 with the <a href="../65k/index.html">65k processor design!</a></p>

		</div></div></div><div id="footer"> </div></div><script type="text/javascript">myUp="../";</script><script type="text/javascript" src="../scripts2-all.js"></script><script type="text/javascript" src="../shariff.min.js"></script></body></html> 

