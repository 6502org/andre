<!DOCTYPE html SYSTEM "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />
<meta name="author" content="André  Fachat" />

<meta name="description" content="Modified C64 kernals" />
<meta name="keywords" content="C64,kernal,kernel" />
<link rev="made" href="mailto:afachat@gmx.de" />
<link rel="stylesheet" title="Default" type="text/css" href="../../style2-min.css" />
<title>New C64 Kernals</title></head>
<body><div id="mainbox"><a name="top" id="top"></a><div class="pagetitle">André's 8-bit pages</div><div id="thanks">
		Thankfully hosted by <a href="http://www.6502.org">6502.org</a>.
	</div><div id="topsearch"><form method="get" action="http://www.google.com/search" target="_blank" autocomplete="off"><input id="searchinput" alt="search" name="q" size="10" maxlength="255" type="text" value="" /><input class="advbutton" value="Search site" type="submit" /><div id="srchprov">(by Google)</div><input name="sitesearch" value="www.6502.org/users/andre" type="hidden" /></form><div id="topfind"><div id="topprogress"></div></div></div><div id="menubox">


<div id="menu1" class="mclose">
<div id="twist1" class="twisty"></div>
<div class="hdrtxt"><a href="../../index.html">Home&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="../../index.html">Home</a></li>
<li><a href="../../contact.html">Contact</a></li>
<li><a href="../../design.html">Web design</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Hardware</span></li>
<li><ul class="nav2" >
<li><a href="../../ultipet/index.html">The Ulti-PET</a>
</li>
<li><a href="../../upet/index.html">The Micro-PET</a>
</li>
<li><a href="../../65k/index.html">The 65k Project</a>
</li>
<li><a href="../../pet816/index.html">PET816 Accelerator</a>
</li>
<li><a href="../../csa/index.html">CS/A65</a>
</li>
<li><a href="../../cbmhw/index.html">CBM mods</a>
</li>
<li><a href="../../spi65b/index.html">SPI65B</a>
</li>
<li><a href="../../xs1541/index.html">XS1541</a>
</li>
<li><a href="../../mischw/index.html">Other hardware</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Software</span></li>
<li><ul class="nav2" >
<li><a href="../../osa/index.html">GeckOS</a>
</li>
<li><a href="../../lib6502/index.html">lib6502 </a>
</li>
<li><a href="../../o65/index.html">o65</a>
</li>
<li><a href="../../usb65/index.html">usb65</a>
</li>
<li><a href="../../xd2031/index.html">XD2031</a>
</li>
<li><a href="../../bdos/index.html">BDOS</a>
</li>
<li><a href="../../misc/index.html">Misc</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Library</span></li>
<li><ul class="nav2" >
<li><a href="../../petindex/index.html">PETindex</a>
</li>
<li><a href="../../adv65/index.html">Advanced 6502</a>
</li>
<li><a href="../../hwinfo/index.html">ICs and Standards</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Knowledge Bits</span></li>
<li><ul class="nav2" >
<li><a href="../../icapos/index.html">Computer/OS Architecture</a>
</li>
<li><a href="../../icaphw/index.html">6502 Hardware Bits</a>
</li>
<li><a href="../../emulation/index.html">Emulation</a>
</li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
<div id="menu2" class="%open%">
<div id="twist2" class="twisty"></div>
<div class="hdrtxt"><a href="../index.html">CBM Modifications&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="../index.html">CBM Modifications</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Accelerator</span></li>
<li><ul class="nav2" >
<li><a href="../../adv65/pet816/index.html">&gt;Speed up your PET!</a></li>
<div class="nend2"></div>
</ul>
</li>
<li><span>Replicas</span></li>
<li><ul class="nav2" >
<li><a href="../ryofat40/index.html">Build your own PET replica!</a>
</li>
<li><a href="../ryo1581/index.html">Build your own VC1581 replica!</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>CS/A adapters</span></li>
<li><ul class="nav2" >
<li><a href="../c64csa/index.html">CS/A adapter for C64</a>
</li>
<li><a href="../petcsa/index.html">CS/A adapter for PETs</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<li><span>Interfaces</span></li>
<li><ul class="nav2" >
<li><a href="../cbmusb/index.html">Userport USB interface</a>
</li>
<li><a href="../petnet/index.html">Put your PET on the 'Net</a>
</li>
<li><a href="../scsi/index.html">CBM SCSI interfaces</a>
</li>
<li><a href="../ieee488/index.html">IEEE488 interfaces</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Misc</span></li>
<li><ul class="nav2" >
<li><a href="../kernal/index.html">C64 kernal modifications</a>
</li>
<li><a href="../hwmods.html">My Hardware mods</a></li>
<li><a href="../8032sk/index.html">A modified 8032-SK</a>
</li>
<li><a href="../../icap/c64ser.html">&gt;UART serial interface</a></li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
	</div><div id="midcol"><div class="top" id="content"><div id="minmax"></div>

<h1>New C64 Kernals</h1><p class="copyright">(C)
- André  Fachat</p> 
<div class="overview"><p>This is Copyright A.Fachat, for distributing use my own
<a href="MYCOPYING.ASC">License</a></p>
  </div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="news" id="news">News:</a></h2></div><div class="h2c"><ul class="news"><li><div> </div><small>2017-08-13</small>
	Added the links to Michael Steil's version of my C64 kernal mods
	on github, where I also added comments to the code.
    </li></ul></div></div><div id="toc" class="h2"><div class="h2h"><div class="h2t"> </div><h2>Table of content</h2></div><div class="h2c"><ul><li><a href="#boot">Boot ROM</a></li><li><a href="#roms">Improved ROMs</a></li><li style="list-style-type:none;"><ul><li><a href="#use">How to use</a></li><li><a href="#archives">Archive descriptions</a></li></ul></li><li><a href="#disc">Disclaimer</a></li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="boot" id="boot">Boot ROM</a></h2></div><div class="h2c"><p> This is a small patch to allow the C64 to boot an arbitrary
file (i.e. "B*") from disk 8 when being Reset.
Well, it also does it when doing "stop/restore", but is that a bug or
a feature now?
The patch is really small, so I only provide the basic executable for it
in the file <a href="bs-l.s07">bs-l.s07</a> and a listing in the file
<a href="bs-l.s07.txt">bs-l.s07.txt</a>.
To assemble, you have to place my <a href="../../misc/index.html">@ASS</a>
at $7000 in memory (or somewhere else if you correct the SYS statement).
Then you have the modified kernal in the RAM under the kernal ROM.
</p>
    </div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="roms" id="roms">Improved ROMs</a></h2></div><div class="h2c"><p> These kernal ROMs do have a lot more new features than the
standard kernal. The place has been taken from the tape routines
and the RS232 routines (the latter have been replaced).
</p>
<p>
These ROMs (esp. version 1.40) have not been tested very well.
They surely contain bugs. You are warned.
</p><p>
The ROM images contain copyrighted code - i.e. they are patched C64 ROMs,
copyrighted by CBM (or whatever remains of this company).
</p><p>
	Note: Michael Steil has taken my kernal modifications and put them
	up on github, where I have also added comments to them and where
	they are much more accessible now.
</p>
    <h3><a name="use" id="use">How to use</a></h3><p>The C64 patches have quite some history, so everything looks a bit messy.
The newest version is 1.40 (of Feb 25, 1997) and has the ACIA serial interface
routines replaced by UART 16550A routines.</p>
<p>
To assemble the source "BS  1.40.S89,P" (C64 BASIC program) yourself,
you have to have my
<a href="../../misc/index.html">@ASS assembler</a> at $7000 in memory (or change the
SYS statements in the source to the correct address).
In line 11090 you can change the address of the
UART in memory. I have it mapped above the SID, at $d600.
In line 12600 you can change the address of the TPI (Tri-Port-Interface)
for the Commodore IEEE488 interface. In line 26085 you can change the
mapping of the IEC devices to parallel and serial bus. A 0 means parallel
IEEE488 bus, a 1 means serial IEC bus. Bit 0 is for device 4, bit 1 for device
5, and so on till bit 6 for device 10. Bit 7 must here be one; device 11
and above are always on the serial bus. If you don't have an IEEE488 interface,
leave TPI at $d600 and change the map value to $ff (i.e. all to serial bus).
You must have an UART in your computer to use this ROM!</p>
<p>
The resulting kernel is then located in the RAM under the kernel ROM.
To access it, you have to fiddle around with the processor port
(POKE 1, $35). This works, because the BASIC interpreter is also copied
during the assemble run :-)
You can then save it with a machine language monitor.</p>
<p>
The same applies for the version "BS  1.33.S88,P", which has the ACIA
routines instead of the UART routines only.</p>
<p>
You can change the mapping of the IEC devices by POKE-ing a new MAP value (as
described above) to $299.
	</p>
	<h3><a name="archives" id="archives">Archive descriptions</a></h3><p>All files with a ".S??" at the end are source files for my selfwritten
6502 Assembler for the C64 (see directory "assembler"). They can be edited
as a BASIC file and a RUN
makes them assemble, if you have my assembler in the computer's memory
(at $7000).
</p> 
<h3><a href="c64bs2.tar.gz">"c64bs2.tar.gz"</a> or
<a href="c64bs2.lzh">"c64bs2.lzh"</a><!-- or
browse the <a href="c64bs2">archive</a>-->.</h3><pre>
"BS  1.*" is a 'new' operating system for the C64 - actually it patches
          the original one and has many more features.
          1) I have an ACIA 6551 at $d600 (above the SID) in my C64, so the
             normal RS232 routines have been exchanged by the 6551 ones.
             note that the 6551 has a bug if you use hardware handshake,
             disabling the outgoing of RTS/CTS also disables the receiver!
             You may loose characters and are warned
          2) in the now plenty of free space there is a Function-Key setting,
             and a Disk-Command-Line interface. You can load/save a programm
             in the directory (without removing "PRG") and standard file
             for load/save/shift-run-stop is IEC device 8.
          3) I have an additional CBM IEEE488 (the parallel one) Interface on
             the expansion port of my C64. Unfortunately the Cartridge ROM
             copied itself to somewhere in $cxxx and completely disabled the
             serial bus. No use for many programms and if you have two drives
             - one parallel and one serial. So I removed the tape routines and
             replaced them with the IEEE488 routines. Now you can choose
             by a POKE (to ????). The IEEE488 routines don't look that well,
             I reassembled them automatically (see another of my tools) from
             the ROM (No not, copying copyrighted code ;-). Actually, this only
             works with the Commodore expansion, so everyone who has them
             should have the right to use this ROM) In the sources in 26080
             the default value for the map is loaded, change it to what you
             want, a one means serial, zero is parallel, Bit 0 is Device 4,
             Bit 7 is device 10, Bit 8 is used to store the actual state.
          4) You can now use decimals like "$12ab" in hex, "&amp;234" in octal
             and "%001010" in binary format. Some special keys for the
             screen editor have been added (Ctrl-Insert, Ctrl-Home and Ctrl-
             Crsr-Right)
          5) This one has some scroll options (try CTRL and CBM keys in
             combination), a Hardcopy-routine (? as far as I see from the
             sources, my C64 is packed) and a screen-blanker?
          This description is for the latest version,
          BS  1.22.S41 is only number 1) and 2).
          BS  1.25.S03 is a reengineering from 1.32, it only has ACIA routines,
                       F-keys, hex/octal/binariy ints, the @-Disk commands but
                       no tape. especially for a friend of mine who doesn't
                       have the IEEE488.
          BS  1.32.S63 has 1) to 4)
          BS  1.33.S88 has all

          BS  1.40.S89 has all except 1, but it has serial line routines
                       for a 16550A UART (with FIFO) instead.

          A ROM image for 1.31, 1.32 and 1.40 is included. The ROM images have
          the UART/ACIA at $d600 and the TPI at $df00.
</pre>
	<ul><li><a href="https://github.com/mist64/c64bs" target="_blank" class="extlink">github repository for the kernal mods</a> </li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="disc" id="disc">Disclaimer</a></h2></div><div class="h2c"><p> BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
REPAIR OR CORRECTION.</p>
<p>
  IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
REDISTRIBUTE THE PROGRAM, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY
GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE
USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS
OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU
OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.
	</p>
	</div></div><hr />
<p>Return to <a href="../../index.html">Homepage</a></p>

  Last modified: 
2017-08-13
	</div></div><div id="rightcol"><div class="top" id="twitter"><div class="tophead">follow</div><div><p>Follow my 8-bit tweets on
		            <a class="extlink" target="_blank" href="https://mastodon.online/@afachat">Mastodon</a> (In new window)
				or <a class="extlink" target="_blank" href="https://bsky.app/profile/afachat.bsky.social">Bluesky</a></p></div></div><div class="top" id="forum"><div class="tophead">discuss</div><div><p>Discuss my site on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=956">this 6502.org forum thread</a></p><p>(Forum registration required to post)</p></div></div><div class="top" id="hot"><div class="tophead">hot!</div><div>
<p>Dive into the retro feeling and build yourself a <a href="../../upet/index.html">Micro-PET</a> or a Multi-board <a href="../../cbmhw/ryofat40/index.html">Commodore 4032</a> replica</p>
<p>Need more speed? Speed up your 6502 computer with this <a href="../../pet816/index.html">10&nbsp;MHz 6502 CPU accelerator board</a></p>
<p>Interested in electronics design? Look at the <a href="../../icaphw/design.html">design lesson</a> I got from Bil Herd, the hardware designer of the C128</p>
<p>Want 64bit? - pimp the 6502 with the <a href="../../65k/index.html">65k processor design!</a></p>

		</div></div></div><div id="footer"> </div></div><script type="text/javascript">myUp="../../";</script><script type="text/javascript" src="../../scripts2-all.js"></script></body></html> 

