<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="author" content="">

<meta name="description" content="65002 documentation">
<meta name="keywords" content="8-bit,6502,65002">
<link rev="made" href="mailto:">
<link rel="stylesheet" title="Default" type="text/css" href="../../style-min.css"><link rel="alternate stylesheet" title="Advanced" type="text/css" href="../../advanced.css">
<title>6502 Software Compatibility Notes</title></head>
<body><div id="mainbox"><a name="top"></a><div id="leftcol"><div id="menu" class="top"><div class="tophead">navigate</div><div id="filter"><form action="#"><table id="filterbox"><tr><td><input alt="menu filter" size="8" name="filter" value="filter" type="text"></td><td><div id="cancel" class="i_cancel">&nbsp;</div></td></tr></table><table id="expcol"><tr><td><div id="expand" class="i_expand">&nbsp;</div></td><td><div id="collapse" class="i_collapse">&nbsp;</div></td></tr></table></form></div>
<div id="mtree">
<a id="m_homepage" href="../../index.html">Homepage</a>
<ul class="menu0" >
<li class="separator">Commodore</li>
<li class="dir" id="m_petindex"><div class="i_dir">&nbsp;</div><a href="../../petindex/index.html">CBM PETindex</a>

</li>
<li class="dir" id="m_cbmhw"><div class="i_dir">&nbsp;</div><a href="../../cbmhw/index.html">CBM hardware and mods</a>

</li>
<li class="separator">Hardware</li>
<li class="dir" id="m_65k"><div class="i_dir">&nbsp;</div><a href="../../65k/index.html">The 65k Project</a>

<ul class="menu1" >
<li><div class="i_file">&nbsp;</div><a href="../features.html">Features</a></li>
<li class="separator">Specification</li>
<li><div class="i_file">&nbsp;</div><a href="../specsprog.html">Programming Model</a></li>
<li><div class="i_file">&nbsp;</div><a href="../future.html">Future Extensions</a></li>
<li><div class="i_link">&nbsp;</div><a href="../af65002">65002</a></li>
<li><div class="i_file">&nbsp;</div><a href="../designnotes.html">Design Notes</a></li>
<li class="separator">Tools</li>
<li><div class="i_file">&nbsp;</div><a href="../crossass.html">Cross-Assembler</a></li>
<li><div class="i_file">&nbsp;</div><a href="../nativetools.html">Native Tools</a></li>
<li class="separator">Implementation</li>
<li><div class="i_file">&nbsp;</div><a href="../arch.html">General architecture</a></li>
<li class="dir" id="m_65k_af65002"><div class="i_dir">&nbsp;</div><a href="../af65002/index.html">af65002 </a>

<ul class="menu2" >
<li class="separator">Specification</li>
<li><div class="i_file">&nbsp;</div><a href="af65002front.html">Overview</a></li>
<li><div class="i_file">&nbsp;</div><a href="af65002regs.html">Register Set</a></li>
<li><div class="i_file">&nbsp;</div><a href="af65002opstruct.html">Opcode Structure</a></li>
<li><div class="i_file">&nbsp;</div><a href="af65002admodes.html">Addressing Modes</a></li>
<li><div class="i_file">&nbsp;</div><a href="af65002prefixes.html">Prefixes</a></li>
<li><div class="i_file">&nbsp;</div><a href="af65002opcodes.html">Opcodes Overview</a></li>
<li><div class="i_file">&nbsp;</div><a href="af65002opdesc.html">Opcode Description</a></li>
<li><div class="i_file">&nbsp;</div><a href="af65002int.html">Reset, Traps and Interrupts</a></li>
<li><div class="i_file">&nbsp;</div><a href="af65002hyper.html">User- and Hypervisor Mode</a></li>
<li><div class="i_file">&nbsp;</div><a href="af65002mem.html">Memory Management</a></li>
<li><div class="i_file">&nbsp;</div><a href="af65002config.html">Configuration Registers</a></li>
<li><div class="i_file">&nbsp;</div><a href="af65002compat.html" class="mcurrent">Compatibility</a></li>
<li class="separator">Implementation</li>
<li><div class="i_file">&nbsp;</div><a href="af65002arch.html">Architecture Overview</a></li>
</ul>
</li>
<li><div class="i_file">&nbsp;</div><a href="../tests.html">Test setup</a></li>
</ul>
</li>
<li class="dir" id="m_csa"><div class="i_dir">&nbsp;</div><a href="../../csa/index.html">CS/A65 Caspaer and Gecko computer</a>

</li>
<li class="dir" id="m_adv65"><div class="i_dir">&nbsp;</div><a href="../../adv65/index.html">Advanced 6502</a>

</li>
<li class="dir" id="m_hwinfo"><div class="i_dir">&nbsp;</div><a href="../../hwinfo/index.html">ICs and Standards Info</a>

</li>
<li class="dir" id="m_mischw"><div class="i_dir">&nbsp;</div><a href="../../mischw/index.html">Other hardware (e.g. tools)</a>

</li>
<li class="separator">Software</li>
<li><div class="i_file">&nbsp;</div><a href="../../osa/index.html">GeckOS operating system</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../lib6502/index.html">Lib6502 standard</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../o65/index.html">O65 file format</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../misc/index.html">Misc software</a>
</li>
<li class="separator">Knowledge Bits</li>
<li class="dir" id="m_icapos"><div class="i_dir">&nbsp;</div><a href="../../icapos/index.html">Computer/OS Architecture</a>

</li>
<li class="dir" id="m_icaphw"><div class="i_dir">&nbsp;</div><a href="../../icaphw/index.html">6502 Hardware Bits</a>

</li>
<li class="separator">Misc</li>
<li><div class="i_file">&nbsp;</div><a href="../../contact.html">Contact</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../sneak.html">Sneak preview</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../design.html">Web design</a></li>
</ul>

</div>
		</div><div class="top" id="browser"><div class="tophead">browser</div><div>
			Site has been tested with a number of browsers and systems. Javascript required for advanced menu, but degrades gracefully without Javascript. IE6 not supported anymore!
			</div></div></div><div id="rightcol"><div class="top" id="google"><div class="tophead">search</div><div><form method="get" action="http://www.google.com/search" target="_blank"><input alt="search parameters" type="text" name="q" size="10" maxlength="255" value=""><input class="advbutton" type="submit" value="Search my site"><br>(Google, in new window)
	                        <input type="hidden" name="sitesearch" value="www.6502.org/users/andre"></form></div></div><div class="top" id="share"><div class="tophead">share</div><div><div id="socialshareprivacy"></div></div></div><div class="top" id="twitter"><div class="tophead">follow</div><div>
		            Follow my 8-bit tweets on<br><a class="extlink" target="_blank" href="https://twitter.com/#!/search/realtime/afachat%20%238bit">Twitter</a><br> (In new window)
		</div></div><div class="top" id="forum"><div class="tophead">discuss</div><div><p>Discuss my site on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=956">this 6502.org forum thread</a></p><p>(Forum registration required to post)</p></div></div><div class="top" id="hot"><div class="tophead">Hot!</div><div>
<p>Dive into the retro feeling and build yourself a <a href="../../cbmhw/ryofat40/index.html">Commodore PET replica</a></p>
<p>Need more speed? Speed up your 6502 computer with this <a href="../../adv65/pet816/index.html">10&nbsp;MHz 6502 CPU replacement board</a></p>
<p>Interested in electronics design? Look at the <a href="../../icaphw/design.html">design lesson</a> I got from Bil Herd, the hardware designer of the C128</p>
<p>Want 64bit? - pimp the 6502 with the <a href="../../65k/index.html">65k processor design!</a></p>

		</div></div></div><div id="midcol"><div class="top" id="ie6warn">
You are using an old MS Internet Explorer as browser. This version is not supported anymore. Please use a 
more modern browser, like Internet Explorer 8 or later, 
<a target="_blank" class="extlink" href="http://www.firefox.com">Firefox</a>,
<a target="_blank" class="extlink" href="http://www.google.com/chrome">Google Chrome</a>, or
<a target="_blank" class="extlink" href="http://www.opera.com">Opera</a>.
</div><div class="top" id="content"><div id="minmax"></div>
<div id="breadcrumbs">
<a href="../../index.html">Homepage</a>
&gt;&gt; <a href="../index.html">The 65k Project</a>&gt;&gt;  <a href="index.html">af65002
</a>&gt;&gt;  Compatibility</div>
<h1>6502 Software Compatibility Notes</h1><div class="overview">
	<p>
        Here are some notes on compatibility with the 6502.
	</p><p>
	The 65002 is binary compatible with the 65C02 - except for minor quirks required for the
	extension, as described on this page.
	</p>
  </div><div id="toc" class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2>Table of content</h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><ul><li><a href="#compatstack">Stack Frame</a></li><li><a href="#compatpointer">Interrupt Pointer</a></li><li><a href="#compatretaddr">Subroutine Return Address</a></li><li><a href="#compattiming">Timing</a></li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="compatstack">Stack Frame</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><p>
          The 65k has, on purpose, an extended interrupt functionality. Thus it needs an extended stack frame
          to store the additional information, as described above. Yet there is 6502 compatibility included:
        </p>
        <table border="1">
        <tr><th colspan="3">Stack Frames</th></tr>
        <tr><th>Address</th><th>6502</th><th>65k</th></tr>
        <tr><th>S+10</th><td rowspan="3"></td><td>ADDR byte 7</td></tr>
        <tr><th>S+5..9</th>                <td>ADDR byte 2..6</td></tr>
        <tr><th>S+4</th>                <td>ADDR byte 1</td></tr>
        <tr><th>S+3</th><td>ADDR byte 1</td><td>ADDR byte 0</td></tr>
        <tr><th>S+2</th><td>ADDR byte 0</td><td>Extended Status Byte</td></tr>
        <tr><th>S+1</th><td>Status register (bit5=1)</td><td>Status Register (bit5=0)</td></tr>
        </table>
        <p>
          As you can see it is the status register bit 5 that determines whether an extended
          stack frame is used or not. In a 6502 it is always 1.
          As a result, if some 6502 software creates an artificial stack frame with bit5 cleared,
          it will trigger the use of an extended stack frame and crash.
        </p>
        </div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="compatpointer">Interrupt Pointer</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><p>
          As the 65k has an extended interrupt functionality, the number - and size - of the 6502 interrupt
          pointer does not suffice anymore for an efficient operation.
        </p>
        <p>
          For compatibility reasons the CPU starts with a restricted set of 6502-compatible interrupt vectors
          as described above. Only when the Interrupt Base Register is set, the extended, per interrupt
          jump vectors are used.
        </p><p>
	  When the processor starts, it starts in hypervisor mode and the compatible interrupt vectors. 
	  Interrupts stay in hypervisor mode and the only incompatibility is the extended stack frame.
        </p>
        </div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="compatretaddr">Subroutine Return Address</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><p>
	The 65k can be configured in 16, 32 or 64 bit width. Thus a return address for a subroutine is
	16, 32, or 64 bit wide. Only a 16 bit wide return address is compatible though.
	</p><p>
	The user mode configuration register however allows to restrict the effective processor width
	to 16 (or 32) bit. In this mode the return address is restricted to 16 bit, and the real address
	is extended with the upper bits (16-31/63) of the program counter.
        </p>
        </div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="compattiming">Timing</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><p>
          The 65k will NOT be timing compatible with the 6502.
        </p><p>
          Although one might think of using an 8-bit accumulator and the typical 6502 pipelining to extend
          the original 6502, this is not the goal of this design.
          The goal is to venture into wider address and data bus sizes, and also use wider accumulators,
          to effectively use the available features of today's programmable logic.
          So this makes it very unlikely, if not impossible, that a timing-compatible 65k will ever exist.
        </p>
        </div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2>Disclaimer</h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c">
All Copyrights are acknowledged.
The information here is provided under the terms as described
in <a href="af65002front.html#lic">the license section</a>.
    </div></div><hr>
Last updated 2012-04-23.
  </div></div><div id="footer">&nbsp;</div></div><script type="text/javascript">myUp="../../";</script><script type="text/javascript" src="../../scripts-all.js"></script><script type="text/javascript" src="../../jquery.socialshareprivacy.js"></script><script type="text/javascript">
          jQuery(document).ready(function($){
                  if($('#socialshareprivacy').length != 0){
                            $('#socialshareprivacy').socialSharePrivacy();
                  }
          });
  </script></body></html> 
