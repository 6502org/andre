<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="author" content="Andr&eacute;  Fachat">

<meta name="description" content="PET index - Drive Architecture">
<meta name="keywords" content="Commodore PET CBM ROM disk drives">
<link rev="made" href="mailto:afachat@gmx.de">
<link rel="stylesheet" title="Default" type="text/css" href="../../../style-min.css"><link rel="alternate stylesheet" title="Advanced" type="text/css" href="../../../advanced.css">
<title>PET index - Drive Architecture</title></head>
<body><div id="mainbox"><a name="top"></a><div id="leftcol"><div id="menu" class="top"><div class="tophead">navigate</div><div id="filter"><form action="#"><table id="filterbox"><tr><td><input alt="menu filter" size="8" name="filter" value="filter" type="text"></td><td><div id="cancel" class="i_cancel">&nbsp;</div></td></tr></table><table id="expcol"><tr><td><div id="expand" class="i_expand">&nbsp;</div></td><td><div id="collapse" class="i_collapse">&nbsp;</div></td></tr></table></form></div>
<div id="mtree">
<a id="m_homepage" href="../../../index.html">Homepage</a>
<ul class="menu0" >
<li class="separator">Commodore</li>
<li class="dir" id="m_petindex"><div class="i_dir">&nbsp;</div><a href="../../../petindex/index.html">CBM PETindex</a>

<ul class="menu1" >
<li class="separator">General Info</li>
<li><div class="i_file">&nbsp;</div><a href="../../gallery/index.html">PET gallery</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../versions.html">PET versions</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../boards.html">Boards and schematics</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../pinouts.html">Connectors</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../keyboards.html">Keyboards</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../extensions.html">Hardware Extensions</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../lang.html">Programming Languages</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../open.html">Open questions</a></li>
<li class="separator">Specials</li>
<li><div class="i_file">&nbsp;</div><a href="../../superpet.html">SuperPET MMF9000</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../8x96.html">The 8096 and 8296 models</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../8032sk.html">The 8032-SK</a></li>
<li class="separator">Peripherals</li>
<li class="dir" id="m_petindex_drives"><div class="i_dir">&nbsp;</div><a href="../../drives/index.html">Disk drives</a>

<ul class="menu2" >
<li><div class="i_file">&nbsp;</div><a href="index.html" class="mcurrent">Drive architecture</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../gallery/index.html">Drive gallery</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../roms/index.html">DOS ROMs</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../progs/index.html">Drive utilities</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../drives.html">Drives list</a></li>
<li><div class="i_file">&nbsp;</div><a href="../harddisk.html">Harddisk info</a></li>
<li><div class="i_file">&nbsp;</div><a href="../writegap.html">Write gap info</a></li>
</ul>
</li>
<li class="separator">Programming</li>
<li><div class="i_file">&nbsp;</div><a href="../../progmod.html">Hardware programming</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../roms.html">ROM descriptions</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../crtc.html">CRTC operation</a></li>
<li class="separator">Quirks</li>
<li class="dir" id="m_petindex_poke"><div class="i_dir">&nbsp;</div><a href="../../poke/index.html">Killer poke</a>

</li>
<li><div class="i_file">&nbsp;</div><a href="../../repairs.html">Repairing the PET</a></li>
<li class="separator">Links</li>
<li><div class="i_file">&nbsp;</div><a href="../../hw.html">Hardware projects</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../sw.html">Software projects</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../emus.html">PET emulators</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../transfer.html">File transfers</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../links.html">Links</a></li>
</ul>
</li>
<li class="dir" id="m_cbmhw"><div class="i_dir">&nbsp;</div><a href="../../../cbmhw/index.html">CBM hardware and mods</a>

</li>
<li class="separator">Hardware</li>
<li class="dir" id="m_65k"><div class="i_dir">&nbsp;</div><a href="../../../65k/index.html">The 65k Project</a>

</li>
<li class="dir" id="m_csa"><div class="i_dir">&nbsp;</div><a href="../../../csa/index.html">CS/A65 Caspaer and Gecko computer</a>

</li>
<li class="dir" id="m_adv65"><div class="i_dir">&nbsp;</div><a href="../../../adv65/index.html">Advanced 6502</a>

</li>
<li class="dir" id="m_hwinfo"><div class="i_dir">&nbsp;</div><a href="../../../hwinfo/index.html">ICs and Standards Info</a>

</li>
<li class="dir" id="m_mischw"><div class="i_dir">&nbsp;</div><a href="../../../mischw/index.html">Other hardware (e.g. tools)</a>

</li>
<li class="separator">Software</li>
<li><div class="i_file">&nbsp;</div><a href="../../../osa/index.html">GeckOS operating system</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../../lib6502/index.html">Lib6502 standard</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../../o65/index.html">O65 file format</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../../misc/index.html">Misc software</a>
</li>
<li class="separator">Knowledge Bits</li>
<li class="dir" id="m_icapos"><div class="i_dir">&nbsp;</div><a href="../../../icapos/index.html">Computer/OS Architecture</a>

</li>
<li class="dir" id="m_icaphw"><div class="i_dir">&nbsp;</div><a href="../../../icaphw/index.html">6502 Hardware Bits</a>

</li>
<li class="separator">Misc</li>
<li><div class="i_file">&nbsp;</div><a href="../../../contact.html">Contact</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../../sneak.html">Sneak preview</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../../design.html">Web design</a></li>
</ul>


</div>
		</div><div class="top" id="browser"><div class="tophead">browser</div><div>
			Site has been tested with a number of browsers and systems. Javascript required for advanced menu, but degrades gracefully without Javascript. IE6 not supported anymore!
			</div></div></div><div id="rightcol"><div class="top" id="google"><div class="tophead">search</div><div><form method="get" action="http://www.google.com/search" target="_blank"><input alt="search parameters" type="text" name="q" size="10" maxlength="255" value=""><input class="advbutton" type="submit" value="Search my site"><br>(Google, in new window)
	                        <input type="hidden" name="sitesearch" value="www.6502.org/users/andre"></form></div></div><div class="top" id="share"><div class="tophead">share</div><div><div id="socialshareprivacy"></div></div></div><div class="top" id="twitter"><div class="tophead">follow</div><div>
		            Follow my 8-bit tweets on<br><a class="extlink" target="_blank" href="https://twitter.com/#!/search/realtime/afachat%20%238bit">Twitter</a><br> (In new window)
		</div></div><div class="top" id="forum"><div class="tophead">discuss</div><div><p>Discuss my site on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=956">this 6502.org forum thread</a></p><p>(Forum registration required to post)</p></div></div><div class="top" id="hot"><div class="tophead">Hot!</div><div>
<p>Dive into the retro feeling and build yourself a <a href="../../../cbmhw/ryofat40/index.html">Commodore PET replica</a></p>
<p>Need more speed? Speed up your 6502 computer with this <a href="../../../adv65/pet816/index.html">10&nbsp;MHz 6502 CPU replacement board</a></p>
<p>Interested in electronics design? Look at the <a href="../../../icaphw/design.html">design lesson</a> I got from Bil Herd, the hardware designer of the C128</p>
<p>Want 64bit? - pimp the 6502 with the <a href="../../../65k/index.html">65k processor design!</a></p>

		</div></div></div><div id="midcol"><div class="top" id="ie6warn">
You are using an old MS Internet Explorer as browser. This version is not supported anymore. Please use a 
more modern browser, like Internet Explorer 8 or later, 
<a target="_blank" class="extlink" href="http://www.firefox.com">Firefox</a>,
<a target="_blank" class="extlink" href="http://www.google.com/chrome">Google Chrome</a>, or
<a target="_blank" class="extlink" href="http://www.opera.com">Opera</a>.
</div><div class="top" id="content"><div id="minmax"></div>
<div id="breadcrumbs">
<a href="../../../index.html">Homepage</a>
&gt;&gt; <a href="../../index.html">CBM PETindex</a>&gt;&gt; <a href="../index.html">Disk drives</a>&gt;&gt;  Drive architecture</div>
<h1>PET index - Drive Architecture</h1><p class="copyright">(C)
1998-2010 Andr&eacute;  Fachat</p> 
<div class="overview"><P>The 5.25" disk drives (and possibly the 8" and harddrives as well) share the same architecture.
In this page you find information about the architecture of these drives.</P>
  </div><div id="toc" class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2>Table of content</h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><ul><li><a href="#overview">Architecture Overview</a></li><li><a href="#gcr">GCR Handling</a></li><li><a href="#memmap">Memory map</a></li><li><a href="#schem">Schematics</a></li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="overview">Architecture Overview</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><P>
The architecture is actually a quite elegant solution to wire two CPUs together, as well as
it has an ingenious method of handling GCR data in hardware.
The following block diagram shows this (click to enlarge):</P>
<P><A HREF="arch.png"><IMG WIDTH="50%" SRC="arch.png" ALT="architecture diagram"></A></P>
<P>
The two CPUs work on a phase inverted clock, i.e. when the 6502 has
Phi2 active, the 6504 is has it passive and vice versa. The CPUs only
use the data bus (approximately) during the active phase, so the data
bus could be shared between the CPUs! The address bus is always active,
so it canot be shared. For the shared RAM, the address bus is switched
with the clock phases. Thus only the shared RAM, and nothing else is
shared between the CPUs.
</P><P>
The DOS CPU has two 6532 as I/O interfaces. They not only provide
the I/O, but also have 128 byte RAM each, that are used for the
CPU's zeropage and stack.
The I/O is mainly used for the IEEE488 interface, as well as the
LEDs and the drive unit detection.
</P><P>
The FDC CPU has a 6530 and a 6522 chip for I/O. The I/O is used to
control the drives. The VIA 6522 is for example used to control the motor and
the head steppers.
</P>
     </div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="gcr">GCR Handling</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><P>
Commodore disk drives store the data in GCR (Group Code Recording) format
on the disks, which is different from the (IMHO inferior), nowadays used MFM
encoding. I will not go into the difference, only note that
in GCR, 4 data bytes are computed into 5 GCR bytes. In fact,
4 data bits are computed into 5 GCR bits.
</P><P>
Now when writing to the disk, the FDC CPU writes the data to the 6530.
This data byte is split into two 4-bit nibbles, and each nibble is expanded
by one bit. The low nibble gets the "mode select" as 5th bit, the high
nibble gets a zero bit. These ten bits are then used as address input to the
ROM. the 8 data lines from the ROM are also expanded: the ROM input A2
(former output data
bit 2) is inserted as output bit 2, and ROM input A7 (former input bit 6)
is inserted as output bit 7. I.e. for each original data nibble, bit 2
(value 4) is directly inserted in the middle of the resulting 5 bit
GCR code. [Note: I have yet to understand why this is so, though... Maybe
the GCR code used had this feature that one bit always was a certain input
bit. Maybe the GCR code was selected that way to allow this mechanism...]
The expanded 10 bit GCR data is now fed into a shift register and sent to
the drive head.
</P><P>
When reading data from the drive, the serial GCR data is parallelized
by a 10 bit shift register. This code is used as input to the same ROM
as above (but with A10 switched, so different ROM content is selected).
The output of the ROM is then read by the CPU.
</P>
     </div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="memmap">Memory map</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><P>The following table has been composed by William Levak:</P>
<PRE>
                        4040 Memory Map
composed by William Levak

            6502                               6504

0000-007F  6532 #1 RAM            6530 RAM            0000-003F
0080-00FF  6532 #2 RAM
0100-01FF  6532 RAM shadows
0200-001F  6532 #1 I/O            6522                0040-004F
0220-027F  6532 #1 I/O shadows    6522 shadows        0050-007F
0280-029F  6532 #2 I/O            6530 I/O            0080-008F
02A0-02FF  6532 #2 I/O shadows    6530 I/O shadows    0090-00BF
0300-03FF  6532 I/O shadows       6522 shodows        00C0-00FF
0400-0FFF  6532 shadows           shadows(0000-00FF)  0100-03FF
1000-13FF  -------------- common RAM 1 -------------  0400-07FF
1400-1FFF  RAM 1 shadows
2000-23FF  -------------- common RAM 2 -------------  0800-0BFF
2400-2FFF  RAM 2 shadows
3000-33FF  -------------- common RAM 3 -------------  0C00-0FFF
3400-3FFF  RAM 3 shadows
4000-43FF  -------------- common RAM 4 -------------  1000-13FF
4400-4FFF  RAM 4 shadows
5000-7FFF  ROM shadows            unconnected         1400-1BFF
8000-8FFF  6532 shadows
9000-CFFF  RAM shadows
D000-FFFF  ROM                    6530 ROM            1C00-1FFF
</PRE>
     </div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="schem">Schematics</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><P>The schematics can be found on the CBM archive in the
<A HREF="http://www.zimmers.net/anonftp/pub/cbm/schematics/drives/old/">old drive schematics page</A>.
</P>
     </div></div><hr>
<p>Return to <a href="../../../index.html">Homepage</a></p>

  </div></div><div id="footer">&nbsp;</div></div><script type="text/javascript">myUp="../../../";</script><script type="text/javascript" src="../../../scripts-all.js"></script><script type="text/javascript" src="../../../jquery.socialshareprivacy.js"></script><script type="text/javascript">
          jQuery(document).ready(function($){
                  if($('#socialshareprivacy').length != 0){
                            $('#socialshareprivacy').socialSharePrivacy();
                  }
          });
  </script></body></html> 
