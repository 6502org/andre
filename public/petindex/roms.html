<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />
<meta name="author" content="Andr&#xE9;  Fachat" />

<meta name="description" content="Commodore PET CBM ROM descriptions" />
<meta name="keywords" content="Commodore PET CBM ROM" />
<link rev="made" href="mailto:afachat@gmx.de" />
<link rel="stylesheet" title="Default" type="text/css" href="../style2-min.css" /><link href="../shariff.min.css" rel="stylesheet" />
<title>Commodore PET ROM descriptions</title></head>
<body><div id="mainbox"><a name="top" id="top"></a><div id="topsearch"><form method="get" action="http://www.google.com/search" target="_blank" autocomplete="off"><input alt="search" name="q" size="10" maxlength="255" type="text" /><input class="advbutton" value="Search site" type="submit" /><div id="srchprov">(by Google)</div><input name="sitesearch" value="www.6502.org/users/andre" type="hidden" /></form><div id="topfind"><div id="topprogress"></div></div></div><div id="menubox">


<div id="menu1" class="mclose">
<div id="twist1" class="twisty"></div>
<div class="hdrtxt"><a href="../index.html">Home&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="../index.html">Home</a></li>
<li><a href="../contact.html">Contact</a></li>
<li><a href="../design.html">Web design</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Hardware</span></li>
<li><ul class="nav2" >
<li><a href="../65k/index.html">The 65k Project</a>
</li>
<li><a href="../pet816/index.html">PET816 Accelerator</a>
</li>
<li><a href="../csa/index.html">CS/A65</a>
</li>
<li><a href="../cbmhw/index.html">CBM mods</a>
</li>
<li><a href="../spi65b/index.html">SPI65B</a>
</li>
<li><a href="../mischw/index.html">Other hardware</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Software</span></li>
<li><ul class="nav2" >
<li><a href="../osa/index.html">GeckOS</a>
</li>
<li><a href="../lib6502/index.html">lib6502 </a>
</li>
<li><a href="../o65/index.html">o65</a>
</li>
<li><a href="../usb65/index.html">usb65</a>
</li>
<li><a href="../xd2031/index.html">XD2031</a>
</li>
<li><a href="../misc/index.html">Misc</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Library</span></li>
<li><ul class="nav2" >
<li><a href="../petindex/index.html">PETindex</a>
</li>
<li><a href="../petindex/drives/index.html">PET drives</a>
</li>
<li><a href="../adv65/index.html">Advanced 6502</a>
</li>
<li><a href="../hwinfo/index.html">ICs and Standards</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Knowledge Bits</span></li>
<li><ul class="nav2" >
<li><a href="../icapos/index.html">Computer/OS Architecture</a>
</li>
<li><a href="../icaphw/index.html">6502 Hardware Bits</a>
</li>
<li><a href="../emulation/index.html">Emulation</a>
</li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
<div id="menu2" class="mopen">
<div id="twist2" class="twisty"></div>
<div class="hdrtxt"><a href="index.html">PETindex&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="index.html">PETindex</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>General Info</span></li>
<li><ul class="nav2" >
<li><a href="gallery/index.html">PET gallery</a>
</li>
<li><a href="versions.html">PET versions</a></li>
<li><a href="boards.html">Boards and schematics</a></li>
<li><a href="pinouts.html">Connectors</a></li>
<li><a href="keyboards.html">Keyboards</a></li>
<li><a href="extensions.html">Hardware Extensions</a></li>
<li><a href="lang.html">Programming Languages</a></li>
<li><a href="open.html">Open questions</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Specials</span></li>
<li><ul class="nav2" >
<li><a href="superpet.html">SuperPET MMF9000</a></li>
<li><a href="8x96.html">The 8096 and 8296 models</a></li>
<li><a href="8032sk.html">The 8032-SK</a></li>
<li><a href="internat.html">Internationalization</a></li>
<div class="nend2"></div>
</ul>
</li>
<li><span>Peripherals</span></li>
<li><ul class="nav2" >
<li><a href="drives/index.html">Disk drives</a>
</li>
<li><a href="periph.html">Others</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Programming</span></li>
<li><ul class="nav2" >
<li><a href="progmod.html">Hardware programming</a></li>
<li><a href="roms.html">ROM descriptions</a></li>
<li><a href="crtc.html">CRTC operation</a></li>
<div class="nend2"></div>
</ul>
</li>
<li><span>Quirks</span></li>
<li><ul class="nav2" >
<li><a href="poke/index.html">Killer poke</a>
</li>
<li><a href="repairs.html">Repairing the PET</a></li>
<li><a href="diag/index.html">Diagnostic Clip</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Links</span></li>
<li><ul class="nav2" >
<li><a href="hw.html">Hardware projects</a></li>
<li><a href="sw.html">Software projects</a></li>
<li><a href="emus.html">PET emulators</a></li>
<li><a href="transfer.html">File transfers</a></li>
<li><a href="links.html">Links</a></li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
	</div><div id="midcol"><div class="top" id="content"><div id="minmax"></div>

<h1>Commodore PET ROM descriptions</h1><p class="copyright">(C)
1998-2013 André  Fachat</p> 
<div class="overview"><p>This page describes the different ROM versions.
	There are basically three parts of each ROM set - for the BASIC ROM version
	and for the so-called editor ROM, and then the kernal.
	</p>
  </div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="news" id="news">News:</a></h2></div><div class="h2c"><ul class="news"><li><div> </div><small>2016-04-24</small>
	Updated and added 6540 links.
    </li><li><div> </div><small>2013-01-04</small>
	Added the section about the BASIC differences
    </li><li><div> </div><small>2011-06-04</small>
	Added links section and to create your own MS Basic, and BASIC as scripting language
    </li><li><div> </div><small>2010-08-28</small>
	Added links to history of MS BASIC and Bill Gates' programming tricks.
    </li></ul></div></div><div id="toc" class="h2"><div class="h2h"><div class="h2t"> </div><h2>Table of content</h2></div><div class="h2c"><ul><li><a href="#hist">Commodore BASIC history</a></li><li><a href="#main">Differences in Software</a></li><li style="list-style-type:none;"><ul><li><a href="#orig">Original ROMs ($C000-$FFFF)</a></li><li><a href="#upgrade">Upgrade ROMs ($C000-$FFFF)</a></li><li><a href="#basic4">4.0 ROMs ($B000-$FFFF)</a></li></ul></li><li><a href="#editor">Editor ROM</a></li><li><a href="#charrom">Character ROM</a></li><li><a href="#hardware">ROM ICs</a></li><li><a href="#links">Links</a></li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="hist" id="hist">Commodore BASIC history</a></h2></div><div class="h2c"><p>The Commodore BASIC was originally created by Microsoft, and bought by 
	Commodore for the use in the KIM and PET computers. The original 6502 BASIC
	was, according to pagetable's analysis, a direct port from the Microsoft 8080 BASIC. 
	It was very generic and for example asked for screen width and memory size on startup.
	It has since then proliferated into "virtually every 6502-based computer",
	including the Commodore, the Apple-II or Atari series.
	</p><p>
	It found its first use in the Commodore BASIC 1 - as found in the 
	original ROMs. In the adoption process Commodore added commands like "OPEN" and other file I/O
	commands, and also renamed the "OK" prompt to "READY.". They also did some "in place"
	binary patching to work around bugs that.
	</p><p>
	Commodore adopted a later version of the BASIC even for the KIM-1. The first KIM, however,
	were shipped with an early version of the 6502 with a buggy "ROR" instruction. So the KIM
	BASIC worked around the broken "ROR" bug.
	</p><p>
	Microsoft later incorporated such changes as well. Commodore went back to Microsoft
	for an update. In that process Microsoft created the famous "WAIT6502,x" Easter Egg 
	in the BASIC2 version.
	A comment in the pagetable's MS BASIC history is supposed to be by Bill Gates and says 
	he put the WAIT easter egg there himself (I'd take that with a grain of salt though).
	</p><p>
	Anyway, the link below is a great analysis of the different MS BASIC versions,
	including the versions for Apple and Altair and how they relate to each other. 
	</p><p>
	In another link it is discussed whether Bill Gates could write code. In fact I believe
	he could. To understand the next part you have to know that the ROM contains the BASIC -
	as written by Microsoft - but also the operating system "kernal" - written by 
	Commodore and used by the BASIC for input/output.
	</p><p>
	The Commodore (MS) BASIC actually uses the "BIT ABS" opcode often to hide a 
	two-byte opcode in the ABS operand. That was also in the Altair's 8080 BASIC version
	written by Gates. The (Commodore) kernal did not use this technique, at least not in
	the first version.
	In fact it could even be his influence that this technique was later used even in the 
	Commodore kernal. Here's one example:
	</p><p>
	The "BASIC 1" kernal for uses
	<pre>
 F0B6  A9 40     TALK       LDA #$40      
 F0B8  D0 02                BNE ATNOUT    
 F0BA  A9 20     LISTEN     LDA #$20      
 F0BC  48        ATNOUT     PHA           
	</pre>
	while the "BASIC 4" kernal uses
	<pre>
 F0D2	TALK	LDA #$40
 F0D4		.byte $2C	; BIT $20A9	note: the "LDA #$20" is hidden in the operand!
 F0D5	LISTEN	LDA #$20
 F0D7	ATNOUT	PHA
	</pre>
	I didn't do a further thorough research though.
	</p>
    <ul><li><a href="http://www.pagetable.com/?p=46" target="_blank" class="extlink">Create your own version of MS BASIC</a> 
		Pagetable's combined BASIC source code, with switches to create Commodore BASIC 1,
		2, AppleSoft II and other variants.
	</li><li><a href="http://www.pagetable.com/?p=45" target="_blank" class="extlink">Working around a broken ROR</a> 
		Quizzing about differences in BASIC versions...
	</li><li><a href="http://www.pagetable.com/?p=43" target="_blank" class="extlink">Bill Gates' Personal Easter Egg in MS BASIC - Pagetable's MS BASIC history</a> 
		Musings about the WAIT6502 easter egg in Commodore BASIC.
		Note one of the commenters...
	</li><li><a href="http://www.theregister.co.uk/2001/05/15/could_bill_gates_write_code/" target="_blank" class="extlink">Could Bill Gates write code?</a> </li><li><a href="http://www.pagetable.com/?p=48" target="_blank" class="extlink">MS BASIC as scripting language</a> 
	</li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="main" id="main">Differences in Software</a></h2></div><div class="h2c">
<P>
Basically there are three different ROM versions that came with the
PET computers, the original ROMs, the upgrade ROMs and the 4.0 ROMs.
Here are some of the peculiarities of the different ROM versions.
(I wished I had more about that; see also the <A HREF="links.html#petfaq">petfaq</A>
file)</P>
<P>ROM images can be found in
<A class="extlink" HREF="http://www.zimmers.net/anonftp/pub/cbm/firmware/computers/pet/">the CBM archive</A></P>
<P>A reverse engineered BASIC source code for versions 1,2 and 4 can be found in the <A HREF="http://www.zimmers.net/anonftp/pub/cbm/src/pet/index.html">CBM archive</A>.</P>
    <h3><a name="orig" id="orig">Original ROMs ($C000-$FFFF)</a></h3><p>
Original ROMs, from $c000, powers up <CODE>*** COMMODORE BASIC ***</CODE>.
To be found in the calculator-style keyboard machines. Horribly broken,
especially the IEEE488 did not work. The
very low level routines worked, but on top of that a lot had to be fixed.
(Note: the VICE emulator includes a patch that allows you to use the BASIC1 ROMs with the IEEE488 disks)
In upper/lower case character mode (as opposed to upper case/graphics mode)
the upper and lower characters were exchanged (SHIFT for lower case).
Arrays could only be 256 elements in size.
There are a lot of other bugs...
	</p><p>
Note that these ROMs had a kind of copy protection: the BASIC PEEK function could
not read out the actual ROM values...
	</p>
	<ul><li><a href="http://www.zimmers.net/anonftp/pub/cbm/firmware/computers/pet/d/rom-1.html" target="_blank" class="extlink">Original ROMs disassembly</a> </li></ul><h3><a name="upgrade" id="upgrade">Upgrade ROMs ($C000-$FFFF)</a></h3><p>
	The `upgrade ROMs' were also known as 2.0 or 3.0 ROMs. Start at $c000, power
up <CODE>### COMMODORE BASIC ###</CODE>
Fix a lot of bugs and make IEEE488 work. Also adds a tiny machine monitor.
Those ROMs have most bugs fixed, although there seem to be different levels
of bug fixing (the
<A class="extlink" HREF="links.html#prodlist">products list</A>
says something about ROM versions 2.0-2.3).
Try and enter "WAIT 6502,1"...
</p>
	<h3><a name="basic4" id="basic4">4.0 ROMs ($B000-$FFFF)</a></h3><p>
Power up with <CODE>*** COMMODORE BASIC 4.0 ***</CODE>.
The 4.0 ROMs add the so-called DISK-BASIC with disk operation commands
(DLOAD, DSAVE, COPY, SCRATCH, DS$ for the error channel etc). The editor
ROM still differs from small screen and large screen versions (board #2 and
boards #3 and #4)...
	</p>
	<ul><li><a href="http://www.zimmers.net/anonftp/pub/cbm/firmware/computers/pet/d/petdis" target="_blank" class="extlink">4.0 ROMs disassembly</a> </li><li><a href="http://www.zimmers.net/cbmpics/cbm/PETx/petmem.txt" target="_blank" class="extlink">4.0 ROMs memory map</a> </li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="editor" id="editor">Editor ROM</a></h2></div><div class="h2c"><p>
In addition to the BASIC (including the kernel)
there are different `editor' ROMs. Those ROMs occupy $e000-$e800
and contain (in the 4.0 ROMs) the screen handling routines. The 4.0 ROMs
can be found in machines with and without CRTC, so they had different
editor ROMs. Also the business and graphics keyboard differ in layout,
so these editor ROMs differ too. The changes for business and graphics
layout in the upgrade ROMs are in $e000-$e800 too.
Later on there were nationalized keyboard versions with additional
ROM in $e900-$efff. In fact the so-called 50Hz and 60Hz versions
have different keyboard layouts and thus different editor ROMs.
</p><p>
For keyboards please have a look at <A HREF="keyboards.html">keyboards</A>
section.
	</p></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="charrom" id="charrom">Character ROM</a></h2></div><div class="h2c"><p>
	The character ROM is the ROM that is used to produce the characters on
the screen. Therefore the scan line number (0-7) is used as address for
the ROM (A0-2), then the 7 lower bits of the byte read from the screen
memory (A3-A9), then the VIA CA2 line as switch between upper/lower
case mode and upper case/graphics mode (A10). This gives a charrom
size of 2k.
</p><P>
You will notice that the highest data bit of the character read from
the screen RAM is not yet used. It is instead directly fed to an
exclusive-OR gate to invert the pixel stream from the character shift
register. This inverts the character by hardware.
</P><p>
The newer models have another line from the CRTC to the character ROM,
namely CRTC MA13 is used as A11 for the charrom. With this line
you can switch to a completely different character set in the charrom.
I assume this is used in nationalized machines with different charsets.
</p></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="hardware" id="hardware">ROM ICs</a></h2></div><div class="h2c"><p>The ROMs of the early boards came with 6540 ICs from Commodore as ROMs
	Those are completely deprecated. Matthew D'Asaro has written an article on them
	and how to replace them with modern chips</p>
	<p>Others have done similar adapters.</p><ul><li><a href="http://www.dasarodesigns.com/product/6540-rom-adapter/" target="_blank" class="extlink">6540 ROM adapter by Matthew D'Asaro</a> </li><li><a href="http://forum.classic-computing.de/index.php?page=Thread&amp;threadID=4369" target="_blank" class="extlink">Other 6540 ROM adapters (see links on page as well)</a> </li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t"> </div><h2><a name="links" id="links">Links</a></h2></div><div class="h2c">This section contains links concerning Commodore (MS) BASIC and kernal ROMs<ul><li><a href="http://www.pagetable.com/?p=48" target="_blank" class="extlink">Commodore BASIC as Unix/Windows scripting language</a> </li></ul></div></div><hr />
<p>Return to <a href="../index.html">Homepage</a></p>

  Last modified: 
2016-04-24
	</div></div><div id="rightcol"><div class="top" id="share"><div class="tophead">share</div><div><div class="shariff" data-backend-url="/users/andre/shariff/index.php" data-theme="grey" data-orientation="vertical"></div></div></div><div class="top" id="twitter"><div class="tophead">follow</div><div><p>Follow my 8-bit tweets on
		            <a class="extlink" target="_blank" href="https://twitter.com/#!/search/realtime/afachat%20%238bit">Twitter</a> (In new window)</p></div></div><div class="top" id="forum"><div class="tophead">discuss</div><div><p>Discuss my site on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=956">this 6502.org forum thread</a></p><p>(Forum registration required to post)</p></div></div><div class="top" id="hot"><div class="tophead">hot!</div><div>
<p>Dive into the retro feeling and build yourself a <a href="../cbmhw/ryofat40/index.html">Commodore PET replica</a></p>
<p>Need more speed? Speed up your 6502 computer with this <a href="../pet816/index.html">10&nbsp;MHz 6502 CPU accelerator board</a></p>
<p>Interested in electronics design? Look at the <a href="../icaphw/design.html">design lesson</a> I got from Bil Herd, the hardware designer of the C128</p>
<p>Want 64bit? - pimp the 6502 with the <a href="../65k/index.html">65k processor design!</a></p>

		</div></div></div><div id="footer"> </div></div><script type="text/javascript">myUp="../";</script><script type="text/javascript" src="../scripts2-all.js"></script><script type="text/javascript" src="../shariff.min.js"></script></body></html> 

