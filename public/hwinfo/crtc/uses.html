<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
<meta name="author" content="Andr&eacute;  Fachat">

<meta name="description" content="CRTC operation">
<meta name="keywords" content="CRTC 6545 6845 operation">
<link rev="made" href="mailto:afachat@gmx.de">
<link rel="stylesheet" title="Default" type="text/css" href="../../style2.css"><link rel="alternate stylesheet" title="Advanced" type="text/css" href="../../advanced.css">
<title>CRTC operation</title></head>
<body><div id="mainbox"><a name="top"></a><div id="topsearch"><form method="get" action="http://www.google.com/search" target="_blank"><input alt="search" name="q" size="10" maxlength="255" type="text"><input class="advbutton" value="Search site" type="submit"><div id="srchprov">(by Google)</div><input name="sitesearch" value="www.6502.org/users/andre" type="hidden"></form><div id="topfind"></div></div><div id="menubox">



<div id="menu1">
<div id="twist1" class="twisty"></div>
<div class="hdrtxt"><a href="../../index.html">Home&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="../../index.html">Home</a></li>
<li><a href="../../contact.html">Contact</a></li>
<li><a href="../../design.html">Web design</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Hardware</span></li>
<li><ul class="nav2" >
<li><a href="../../65k/index.html">The 65k Project</a>
</li>
<li><a href="../../csa/index.html">CS/A65</a>
</li>
<li><a href="../../cbmhw/index.html">CBM mods</a>
</li>
<li><a href="../../spi65b/index.html">SPI65B</a>
</li>
<li><a href="../../mischw/index.html">Other hardware</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Software</span></li>
<li><ul class="nav2" >
<li><a href="../../osa/index.html">GeckOS</a>
</li>
<li><a href="../../lib6502/index.html">lib6502 </a>
</li>
<li><a href="../../o65/index.html">o65</a>
</li>
<li><a href="../../usb65/index.html">usb65</a>
</li>
<li><a href="../../xd2031/index.html">XD2031</a>
</li>
<li><a href="../../misc/index.html">Misc</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Library</span></li>
<li><ul class="nav2" >
<li><a href="../../petindex/index.html">PETindex</a>
</li>
<li><a href="../../adv65/index.html">Advanced 6502</a>
</li>
<li><a href="../../hwinfo/index.html">ICs and Standards</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Knowledge Bits</span></li>
<li><ul class="nav2" >
<li><a href="../../icapos/index.html">Computer/OS Architecture</a>
</li>
<li><a href="../../icaphw/index.html">6502 Hardware Bits</a>
</li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
<div id="menu2">
<div id="twist2" class="twisty"></div>
<div class="hdrtxt"><a href="../index.html">Hardware Info&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="../index.html">Hardware Info</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Chips</span></li>
<li><ul class="nav2" >
<li><a href="../crtc/index.html">CRTC 6545/6845</a>
</li>
<li><a href="../ls610/index.html">74LS610 MMU</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Interfaces</span></li>
<li><ul class="nav2" >
<li><a href="../scsi.html">SCSI</a></li>
<li><a href="../i2c.html">I2C</a></li>
<li><a href="../spi/index.html">SPI (MMC, SD-Cards)</a>
</li>
<li><a href="../ethernet/index.html">Ethernet and TCP/IP</a>
</li>
<li><a href="../usb/index.html">USB</a>
</li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
<div id="menu3">
<div id="twist3" class="twisty"></div>
<div class="hdrtxt"><a href="index.html">CRTC&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="index.html">CRTC</a></li>
<li><a href="crtc.html">CRTC operation</a></li>
<li><a href="diffs.html">Differences between models</a></li>
<li><a href="uses.html">CRTC system integration</a></li>
<li><a href="internals/index.html">CRTC internals</a>
</li>
<li><a href="composite.html">Composite video generation</a></li>
<li><a href="pet/index.html">CBM PET test programs</a>
</li>
<li><a href="../../csa/vdc/index.html">&gt;CS/A VDC board</a></li>
<li><a href="../../cbmhw/8032sk/index.html">&gt;Creative use</a></li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
	</div><div id="midcol"><div class="top" id="content"><div id="minmax"></div>

<h1>CRTC operation</h1><p class="copyright">(C)
1998-2010 Andr&eacute;  Fachat</p> 
<div class="overview">
<P>The 6545/6845 Cathode Ray Tube Controller (CRTC) is a flexible
video chip. It has been used in the Commodore PET computers,
and even early PC graphics cards.
</P>
<P>
For the operation of the video interface Commodore introduced the
Cathode Ray Tube Controller (CRTC) 6545 with the third type of boards.
This controller is very flexible, programmable and provides all
necessary interface signals for the video hardware.
</P>
<P>I have made a collection of test programs and timing
examples for the CRTC in my CBM 8296. You can download the whole
suite, including a (derived) diagram of the CRTC internals from the CBM archive
as
<A HREF="http://www.zimmers.net/anonftp/pub/cbm/pet/programming/index.html">crtctest-1.1.tar.gz</A>.
It also includes a summary of the differences of the various
CRTC models.
You can have a look at some of the weird screen distortions in
the <A HREF="pet/index.html">test program documentation</A>, and an
overview over the derived CRTC internals on
<A HREF="internals/index.html">this page</A>
(all from the crtctest archive).
</P><P>A sample schematic can be found on the
<A HREF="http://www.6502.org/users/andre/csa/">CS/A65</A>
computer page or in the PET schematics on the
<A HREF="../../petindex/links.html">links page</A> of the PET index.
</P>
  </div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="news">News:</a></h2></div><div class="h2c"><ul class="news"><li><div>&nbsp;</div><small>2010-12-20</small>
	Separated from the main <a href="crtc.html">CRTC</a> page.
    </li></ul></div></div><div id="toc" class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2>Table of content</h2></div><div class="h2c"><ul><li><a href="#pet">Example CRTC use in the Commodore PET</a></li><li style="list-style-type:none;"><ul><li><a href="#fat40">PET 4032 'Fat40'</a></li><li><a href="#8032">PET 8032</a></li><li><a href="#8296">PET 8296</a></li></ul></li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="pet">Example CRTC use in the Commodore PET</a></h2></div><div class="h2c">
<P>
There are a few things that might be different from other implementations
in the PET. The CRTC has been used in 40 columns and 80 columns models.
The CCLK frequency however is 1 MHz in both cases. 80 columns mode
is achieved by reading not one byte but two byte in each CCLK
cycle with the same
MA0-13, thus effectively using the MA0-9 as A1-10.
</P>
<P>
As only MA0-9 are used, Commodore decided to use the uppermost two
bits (MA12 and MA13) as additional control lines. MA12 is used
to invert the complete pixel stream video output, probably to be able
to cope with different video hardware. MA13 is used as an additional
A11 to switch the 2k halfs of a newer 4k charrom. This is used
for nationalized character sets?
</P>
<P>
Only seven bit of the data read from memory are used for character
ROM addressing. The 8th bit is instead directly fed to an inverter,
inverting the pixel stream if set - thus inverting the character.
</P>
<P>
The Cursor hardware is not used.
</P>
<P>
If more than 8 scanlines per character are used the hardware automatically
blanks the scanlines for the scanlines beyond the 8th.
Without that and only RA0-2 used for character ROM address the
same character would be redisplayed from the start.
</P>
    <h3><a name="fat40">PET 4032 'Fat40'</a></h3>
<P>The so-called 'Fat40' is a 4032 model that has a 12" screen
and a "universal board" - a board that can be used for the 8032 or the
4032. Thus it uses the CRTC as video chip. A separate static memory
separate from main memory is used as video RAM.
</P>
<PRE>
PET 4032 CRTC usage block diagram
---------------------------------


                |               CRTC                                                      |
                ---------------------------------------------------------------------------
           MA0-9  |                              RA0-2 |    -------                   DE|
                  |                                    |    |     |                     |
                  |  -----      -------                -----|A0-2 |      -----          |  ---
                  |  |   |      |     |       -----         |     |D0-7  |   |     ---  +--| | Video
                  +--|   | A0-9 |     | D0-7  |   |    D0-6 |     |------|   |-----| |     |&gt;|---
                     | &gt; |------| RAM |---+---|   |---+-----|A3-8 |      |   |     | |-----| |
 CPU A0-9 -----------|   |      |     |   |   |   |   |     |     |      -----   +-| |     ---
                     |   |      |     |   |   -----   |     -------      shift   | ---      AND
                     -----      -------   |   Latch   |     Charrom     register |  XOR
                   Mux 2-to-1             |           |D7                        |
                                          |           +--------------------------+
                     -----                |
                     |   |                |
 CPU D0-7 -----------|   |----------------+
                     |   |
                     -----
                    Buffer
</PRE>
<P>
During Phi2 low (Processor does not use the bus) the Mux chip selects
the MA0-9 address lines from the CRTC. The video RAM then outputs the
character value and it is saved in the latch. The latch output is then
used as input for the Charrom. The output of which is given to the
shift register that makes a pixel stream rather than a byte stream.
</P>
<P>
When Phi2 is high then the Mux selects the CPU address lines for the
video RAM, allowing normal CPU memory accesses.
</P>
<P>
The Vertical Sync signal of the CRTC is not only used for video
hardware control but it is also (inverted and) connected to the
PIA1 CB1 line to
generate system interrupts with the frame rate. Also the state
of this line can be checked with VIA PB5.
</P>
	<h3><a name="8032">PET 8032</a></h3>
<P>The universal board can also be used in the 8032. As the 8032 also
runs on 1MHz only, there is a problem with the memory bandwidth.
The memory used was static RAM with a maximum access frequency of
2MHz. As half the cycles were reserved for the CPU (Phi2 high),
only 1MHz video RAM bandwidth was left, which is only enough for
40 columns a line - with an 8 bit graphics data bus.
</P><P>In the 8032, however, Commodore decided to use a 16 bit
graphics data bus. How does this work? The video memory is separated
into to areas of 1kByte each, that the CPU can write to independetly
with 8 bit access. One area is for even addresses, the other for
odd CPU memory addresses. The video circuitry, however, reads both
the RAM areas at the same time (thus twice 8bit = 16bit access), and
latches both values. To generate the video signal than first the
value from the even area, then the one from the odd area is used.
</P>
<PRE>
PET 8032 CRTC usage block diagram
---------------------------------


                |               CRTC                                                        |
                -----------------------------------------------------------------------------
           MA0-9  |                                RA0-2 |    -------                   DE|
                  |                                      |    |     |                     |
                  |  -----      -------         even     +----|A0-2 |      -----          |  ---
                  |  |   |      |     |         -----         |     |D0-7  |   |     ---  +--| | Video
                  +--|   | A0-9 | even| D0-7    |   |    D0-6 |     |------|   |-----| |     |&gt;|---
                     | &gt; |---+--| RAM |---+-----|   |-+-+-----|A3-8 |      |   |     | |-----| |
 CPU A0-9 -----------|   |   |  |     |   |     |   | | |     |     |      -----   +-| |     ---
                     |   |   |  |     |   |     ----- | |     -------      shift   | ---      AND
                     -----   |  -------   |     Latch | |     Charrom     register |  XOR
                      Mux    |            |           | |  D7                      |
                     2-to-1  |            |           | +--------------------------+
                             |  -------   |      odd  |
                             |  |     |   |     ----- |D0-7
                             |  | odd |   |     |   | |
                             +--| RAM |--/|\-+--|   |-+
                                |     |   |  |  |   |
                                |     |   |  |  -----
                     even       -------   |  |  Latch
                     -----                |  |
                     |   |                |  |
 CPU D0-7 ------+----|   |-----------------  |
                |    |   |                   |
                |    -----                   |
                |     odd                    |
                |    -----                   |
                |    |   |                   |
                -----|   |-------------------+
                     |   |
                     -----
                     Buffer
</PRE>
<P>This diagram shows how the RAM and latches are doubled for even and odd addresses.
It also makes it clear that it is a relatively simple addition to the 4032 to display
80 columns. This is one reason why universal boards are actually feasible.
</P><P>This setup also explains why even the 80 columns PET actually initialize the
CRTC video chip with 40 columns - as the video RAM bus width is 16bit instead of 8bit,
each of the CRTC character actually is two characters on the screen.
</P>
	<h3><a name="8296">PET 8296</a></h3>
<P>The 8296 is a different beast altogether. Here the separate static video memory is
completely gone. All the memory of the system (actually 128k, of which 96k can be
used as main memory and 4k as video memory) is put into two dynamic RAM banks of
64k each.
</P>
<PRE>
PET 8296 CRTC usage block diagram
---------------------------------


                |               CRTC                                                        |
                -----------------------------------------------------------------------------
           MA0-9  |                                RA0-2 |    -------                   DE|
                  |                                      |    |     |                     |
                  |  -----      -------         even     +----|A0-2 |      -----          |  ---
                  |  |   | DRM  |     |         -----         |     |D0-7  |   |     ---  +--| | Video
                  +--|   | 0-7  | 64k | D0-7    |   |    D0-6 |     |------|   |-----| |     |&gt;|---
                  |  | &gt; |---+--| RAM |---+-----|   |-+-+-----|A3-8 |      |   |     | |-----| |
                  +--|   |   |  |     |   |     |   | | |     |     |      -----   +-| |     ---
                     |   |   |  |     |   |     ----- | |     -------      shift   | ---      AND
                     -----   |  -------   |     Latch | |     Charrom     register |  XOR
                      Mux    |            |           | |  D7                      |
                     2-to-1  |            |           | +--------------------------+
                     -----   |  -------   |      odd  |
                     |   |   |  |     |   |     ----- |D0-7
               +-----|   |   |  | 64k |   |     |   | |
 CPU A0-15 ----+     | &gt; |---+--| RAM |---+-----|   |-+
               +-----|   |      |     |   |     |   |
                     |   |      |     |   |     -----
                     -----      -------   |     Latch
                                          |
                     -----                |
                     |   |                |
 CPU D0-7 -----------|   |-----------------
                     |   |
                     -----
</PRE>
<P>As opposed to static RAM, dynamic RAM requires multiplexed address
lines. Therefore both, the CPU and CRTC address lines are multiplexed
separately with 74ls257 ICs that are enabled only when the CPU or
CRTC respectively accesses the memory.</P>
<P>The diagram shows that now the dRAM address and data lines are
shared between the two 64k memory banks. This means that only one access
can happen at a time. as a result, to display 80 columns, it is necessary
that the memory is accessed faster than 2MHz. In fact it is accessed
faster, with approx. 4Mhz, as can be seen in the description of the UC2
PLA logic equations in <a href="local/8296desc.txt">8296desc.txt</a>.
</P>
	</div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2>Disclaimer</h2></div><div class="h2c">
All Copyrights are acknowledged.
The information here is provided under the terms of the
GNU Public License version 2 unless noted otherwise.
  </div></div><hr>
<p>Return to <a href="../../index.html">Homepage</a></p>
	
  </div></div><div id="rightcol"><div class="top" id="twitter"><div class="tophead">follow</div><div>
		            Follow my 8-bit tweets on<br><a class="extlink" target="_blank" href="https://twitter.com/#!/search/realtime/afachat%20%238bit">Twitter</a><br> (In new window)
		</div></div><div class="top" id="forum"><div class="tophead">discuss</div><div><p>Discuss my site on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=956">this 6502.org forum thread</a></p><p>(Forum registration required to post)</p></div></div><div class="top" id="hot"><div class="tophead">Hot!</div><div>
<p>Dive into the retro feeling and build yourself a <a href="../../cbmhw/ryofat40/index.html">Commodore PET replica</a></p>
<p>Need more speed? Speed up your 6502 computer with this <a href="../../adv65/pet816/index.html">10&nbsp;MHz 6502 CPU replacement board</a></p>
<p>Interested in electronics design? Look at the <a href="../../icaphw/design.html">design lesson</a> I got from Bil Herd, the hardware designer of the C128</p>
<p>Want 64bit? - pimp the 6502 with the <a href="../../65k/index.html">65k processor design!</a></p>

		</div></div></div><div id="footer">&nbsp;</div></div><script type="text/javascript">myUp="../../";</script><script type="text/javascript" src="../../scripts2-all.js"></script></body></html> 
