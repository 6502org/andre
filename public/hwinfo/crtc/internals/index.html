<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
<meta name="author" content="Andr&eacute;  Fachat">

<meta name="description" content="CRTC (Cathode Ray Tube Controller) 6545 internals">
<meta name="keywords" content="CRTC Cathode Ray Tube Controller 6545 interals description">
<link rev="made" href="mailto:afachat@gmx.de">
<link rel="stylesheet" title="Default" type="text/css" href="../../../style2-min.css">
<title>The CRTC internals</title></head>
<body><div id="mainbox"><a name="top"></a><div id="topsearch"><form method="get" action="http://www.google.com/search" target="_blank" autocomplete="off"><input alt="search" name="q" size="10" maxlength="255" type="text"><input class="advbutton" value="Search site" type="submit"><div id="srchprov">(by Google)</div><input name="sitesearch" value="www.6502.org/users/andre" type="hidden"></form><div id="topfind"><div id="topprogress"></div></div></div><div id="menubox">



<div id="menu1" class="mclose">
<div id="twist1" class="twisty"></div>
<div class="hdrtxt"><a href="../../../index.html">Home&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="../../../index.html">Home</a></li>
<li><a href="../../../contact.html">Contact</a></li>
<li><a href="../../../design.html">Web design</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Hardware</span></li>
<li><ul class="nav2" >
<li><a href="../../../65k/index.html">The 65k Project</a>
</li>
<li><a href="../../../pet816/index.html">PET816 Accelerator</a>
</li>
<li><a href="../../../csa/index.html">CS/A65</a>
</li>
<li><a href="../../../cbmhw/index.html">CBM mods</a>
</li>
<li><a href="../../../spi65b/index.html">SPI65B</a>
</li>
<li><a href="../../../mischw/index.html">Other hardware</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Software</span></li>
<li><ul class="nav2" >
<li><a href="../../../osa/index.html">GeckOS</a>
</li>
<li><a href="../../../lib6502/index.html">lib6502 </a>
</li>
<li><a href="../../../o65/index.html">o65</a>
</li>
<li><a href="../../../usb65/index.html">usb65</a>
</li>
<li><a href="../../../xd2031/index.html">XD2031</a>
</li>
<li><a href="../../../misc/index.html">Misc</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Library</span></li>
<li><ul class="nav2" >
<li><a href="../../../petindex/index.html">PETindex</a>
</li>
<li><a href="../../../adv65/index.html">Advanced 6502</a>
</li>
<li><a href="../../../hwinfo/index.html">ICs and Standards</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Knowledge Bits</span></li>
<li><ul class="nav2" >
<li><a href="../../../icapos/index.html">Computer/OS Architecture</a>
</li>
<li><a href="../../../icaphw/index.html">6502 Hardware Bits</a>
</li>
<li><a href="../../../emulation/index.html">Emulation</a>
</li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
<div id="menu2" class="mclose">
<div id="twist2" class="twisty"></div>
<div class="hdrtxt"><a href="../../index.html">Hardware Info&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="../../index.html">Hardware Info</a></li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Chips</span></li>
<li><ul class="nav2" >
<li><a href="../../crtc/index.html">CRTC 6545/6845</a>
</li>
<li><a href="../../ls610/index.html">74LS610 MMU</a>
</li>
<div class="nend2"></div>
</ul>
</li>
<div class="nend1"></div>
</ul>
<ul class="nav1" >
<li><span>Interfaces</span></li>
<li><ul class="nav2" >
<li><a href="../../scsi.html">SCSI</a></li>
<li><a href="../../i2c.html">I2C</a></li>
<li><a href="../../spi/index.html">SPI (MMC, SD-Cards)</a>
</li>
<li><a href="../../ethernet/index.html">Ethernet and TCP/IP</a>
</li>
<li><a href="../../usb/index.html">USB</a>
</li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
<div id="menu3" class="%open%">
<div id="twist3" class="twisty"></div>
<div class="hdrtxt"><a href="../index.html">CRTC 6545/6845&nbsp;&gt;</a></div>
<ul class="nav1">
<li>
<ul class="nav2">
<li class="navhdr"><a href="../index.html">CRTC 6545/6845</a></li>
<li><a href="../crtc.html">CRTC operation</a></li>
<li><a href="../diffs.html">Differences between models</a></li>
<li><a href="../uses.html">CRTC system integration</a></li>
<li><a href="../internals/index.html">CRTC internals</a>
</li>
<li><a href="../composite.html">Composite video generation</a></li>
<li><a href="../pet/index.html">CBM PET test programs</a>
</li>
<li><a href="../../../csa/vdc/index.html">&gt;CS/A VDC board</a></li>
<li><a href="../../../cbmhw/8032sk/index.html">&gt;Creative use</a></li>
</ul>
<div class="nend2"></div>
</li>
<div class="nend1"></div>
</ul>
</div>
	</div><div id="midcol"><div class="top" id="content"><div id="minmax"></div>

<h1>The CRTC internals</h1><p class="copyright">(C)
1999-2010 Andr&eacute;  Fachat</p> 
<div class="overview">
<p>
I have deduced from the timing measurements done with the test
programs an internal structure. The CRTC basically works with
compare elements that only compare for equality. Thus, by writing
values lower than the current counter, it is possible to do some
tricks to the CRTC.
</p><p>
Of course only after I derived the structure myself, I found this
diagram of the <a href="68B45-10.png">6845</a> internal structure...
Also I have documented the differences between the different
CRTC models in the diffs page <a href="../diffs.html">diffs.txt</a>.
</p>
<p>
I have to note that my model is only an approximate model, to
demonstrate the effects in the CRTC. It is not to be understood
as a correct schematics.
</p><p>
In the following I will use the term <em>rasterline</em> for one
go of the electron beam from the left to the right border of
the screen. A <em>characterline</em> consists of a number of
rasterlines that make up a line of characters.
</p>
  </div><div id="toc" class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2>Table of content</h2></div><div class="h2c"><ul><li><a href="#timingoverview">Timing overview</a></li><li><a href="#rasterline">Rasterline timing</a></li><li><a href="#endline">End-of-line pulse</a></li><li><a href="#vertical">Vertical timing</a></li><li><a href="#memcount">Memory counter</a></li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="timingoverview">Timing overview</a></h2></div><div class="h2c"> 
<p>
The CRTC timing is different from, for example, the VIC-II timing
of the C64. There the underlying timing is fixed and it even needs
different chips for PAL and NTSC timings. The CRTC is much more
flexible, because any timing value can be controlled by writing
to the registers.
Please note that the CRTC timing starts with the first rasterline of
the first displayed
character, not somewhere in the upper left corner of the screens border.
The end of the CRTC rasterline is thus wrapped around to the left border.
An overview can be seen in figure 0 (click on the image for a large view).
</p>
<a href="crtc0.png"><img src="crtc0.png" alt="crtc0.png" width="20%"></a>
    </div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="rasterline">Rasterline timing</a></h2></div><div class="h2c"> 
<p>
The rasterline timing is done by the circuits in figure 1.
</p>
<a href="crtc1.png"><img src="crtc1.png" alt="crtc1.png" width="20%"></a>
<p>
The main counter character counter is clocked by the character clock.
Starting from 0 the counter counts each character. The first comparator
compares to the number of characters a line minus 1 (register 0).
When this value is reached, the counter is reset to zero in the next
cycle, starting a new rasterline.
The character counter is 8 bit, allowing up to 256 chars per line.
</p><p>
The second comparator compares the counter to the number of visible
characters. The output is then used to reset the HDispEnable line,
i.e. disable the DE line (see below). The DE line is enabled when
the counter is reset again, enabling the display output.
</p>
    </div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="endline">End-of-line pulse</a></h2></div><div class="h2c"> 
<p>
The EndLine pulse is used by the counter for rasterlines/char.
</p>
<a href="crtc2.png"><img src="crtc2.png" alt="crtc2.png" width="20%"></a>
<p>
Here a very similar mechanics is used to determine the height of
a charline. The second and third are used to enable the hardware
cursor (that is not used in the PET).
</p>
    </div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="vertical">Vertical timing</a></h2></div><div class="h2c"> 
<p>
The next part does the vertical timing by counting character lines
(and rasterlines for the adjust)
</p>
<a href="crtc3.png"><img src="crtc3.png" alt="crtc3.png" width="20%"></a>
<p>
Here the very same technique is assumed to be used as for the
horizontal timing. In addition to that, however, the rasterline
adjustment for the vertical timing needs another counter.
(It is not clear, however, if not the rasterline counter for the charline
is re-used for this purpose. It would mean one counter less, but the
counter reset needs to be switched between register 9 and register 5).
</p>
    </div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="memcount">Memory counter</a></h2></div><div class="h2c"> 
<p>
Finally the memory counter needs to be discussed.
</p>
<a href="crtc4.png"><img src="crtc4.png" alt="crtc4.png" width="20%"></a>
<p>
The main memory counter is clocked by CCLK. It is loaded at the
beginning of each new rasterline. When in the last rasterline of
a char the character behind the visible one is reached, a second
latch is loaded with the current memory pointer value - which is
the first char of the next charline.
From this value the counter is loaded. At the beginning of each rasterline.
Only at the beginning of the screen the counter is loaded from
the registers 13/12 of the CRTC. The counter, Regs 12/13 and Regs 14/15
are 14 bit long only.
</p>
<p>
One comparator compares the current memory pointer with the cursor position
register. If also the cursor is in the right lines the CE, Cursor Enable
output is active.
</p>
<p>
The DE output is active only when the rasterbeam is in the visible
area horizontally and vertically.
</p>
<p>
The counter can count in two different modes. In the first mode the counter
counts straight binary. This mode is mostly used (I have not seen any
system using the second mode). The second mode is called row/column.
Here the address lines MA0-7 generate an 8-bit column address and
MA8-13 generate a 6-bit row address.
The manual states that "extra hardware is needed to compress this
addressing into a straight binary sequence in order to conserve memory".
The memory access for both schemes during one frame can be seen
in the next figure
</p>
<a href="crtc5.png"><img src="crtc5.png" alt="crtc5.png" width="20%"></a>
    </div></div><hr>
<p>Return to <a href="../../../index.html">Homepage</a></p>

  Last modified: 
2010-05-24
	</div></div><div id="rightcol"><div class="top" id="share"><div class="tophead">share</div><div><div id="socialshareprivacy"></div></div></div><div class="top" id="twitter"><div class="tophead">follow</div><div><p>Follow my 8-bit tweets on
		            <a class="extlink" target="_blank" href="https://twitter.com/#!/search/realtime/afachat%20%238bit">Twitter</a> (In new window)</p></div></div><div class="top" id="forum"><div class="tophead">discuss</div><div><p>Discuss my site on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=956">this 6502.org forum thread</a></p><p>(Forum registration required to post)</p></div></div><div class="top" id="hot"><div class="tophead">hot!</div><div>
<p>Dive into the retro feeling and build yourself a <a href="../../../cbmhw/ryofat40/index.html">Commodore PET replica</a></p>
<p>Need more speed? Speed up your 6502 computer with this <a href="../../../pet816/index.html">10&nbsp;MHz 6502 CPU accelerator board</a></p>
<p>Interested in electronics design? Look at the <a href="../../../icaphw/design.html">design lesson</a> I got from Bil Herd, the hardware designer of the C128</p>
<p>Want 64bit? - pimp the 6502 with the <a href="../../../65k/index.html">65k processor design!</a></p>

		</div></div></div><div id="footer">&nbsp;</div></div><script type="text/javascript">myUp="../../../";</script><script type="text/javascript" src="../../../scripts2-all.js"></script><script type="text/javascript" src="../../../jquery.socialshareprivacy.min.js"></script></body></html> 
