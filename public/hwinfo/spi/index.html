<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="author" content="Andr&eacute;  Fachat">

<meta name="description" content="SPI information">
<meta name="keywords" content="SPI">
<link rev="made" href="mailto:afachat@gmx.de">
<link rel="stylesheet" title="Default" type="text/css" href="../../style-min.css"><link rel="alternate stylesheet" title="Advanced" type="text/css" href="../../advanced.css">
<title>SPI Information</title></head>
<body><div id="mainbox"><a name="top"></a><div id="leftcol"><div id="menu" class="top"><div class="tophead">navigate</div><div id="filter"><form action="#"><table id="filterbox"><tr><td><input alt="menu filter" size="8" name="filter" value="filter" type="text"></td><td><div id="cancel" class="i_cancel">&nbsp;</div></td></tr></table><table id="expcol"><tr><td><div id="expand" class="i_expand">&nbsp;</div></td><td><div id="collapse" class="i_collapse">&nbsp;</div></td></tr></table></form></div>
<div id="mtree">
<a id="m_homepage" href="../../index.html">Homepage</a>
<ul class="menu0" >
<li class="separator">Commodore</li>
<li class="dir" id="m_petindex"><div class="i_dir">&nbsp;</div><a href="../../petindex/index.html">CBM PETindex</a>

</li>
<li class="dir" id="m_cbmhw"><div class="i_dir">&nbsp;</div><a href="../../cbmhw/index.html">CBM hardware and mods</a>

</li>
<li class="separator">Hardware</li>
<li class="dir" id="m_65k"><div class="i_dir">&nbsp;</div><a href="../../65k/index.html">The 65k Project</a>

</li>
<li class="dir" id="m_csa"><div class="i_dir">&nbsp;</div><a href="../../csa/index.html">CS/A65 Caspaer and Gecko computer</a>

</li>
<li class="dir" id="m_adv65"><div class="i_dir">&nbsp;</div><a href="../../adv65/index.html">Advanced 6502</a>

</li>
<li class="dir" id="m_hwinfo"><div class="i_dir">&nbsp;</div><a href="../../hwinfo/index.html">ICs and Standards Info</a>

<ul class="menu1" >
<li class="dir" id="m_hwinfo_crtc"><div class="i_dir">&nbsp;</div><a href="../crtc/index.html">CRTC 6545/6845</a>

</li>
<li class="dir" id="m_hwinfo_ls610"><div class="i_dir">&nbsp;</div><a href="../ls610/index.html">74LS610 MMU</a>

</li>
<li><div class="i_file">&nbsp;</div><a href="../scsi.html">SCSI</a></li>
<li><div class="i_file">&nbsp;</div><a href="../i2c.html">I2C</a></li>
<li class="dir" id="m_hwinfo_spi"><div class="i_dir">&nbsp;</div><a href="index.html" class="mcurrent">SPI (MMC, SD-Cards)</a>

<ul class="menu2" >
<li><div class="i_file">&nbsp;</div><a href="spi65b/index.html">SPI65/B</a>
</li>
</ul>
</li>
<li><div class="i_file">&nbsp;</div><a href="../ethernet/index.html">Ethernet and TCP/IP</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../usb/index.html">USB</a>
</li>
</ul>
</li>
<li class="dir" id="m_mischw"><div class="i_dir">&nbsp;</div><a href="../../mischw/index.html">Other hardware (e.g. tools)</a>

</li>
<li class="separator">Software</li>
<li><div class="i_file">&nbsp;</div><a href="../../osa/index.html">GeckOS operating system</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../lib6502/index.html">Lib6502 standard</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../o65/index.html">O65 file format</a>
</li>
<li><div class="i_file">&nbsp;</div><a href="../../misc/index.html">Misc software</a>
</li>
<li class="separator">Knowledge Bits</li>
<li class="dir" id="m_icapos"><div class="i_dir">&nbsp;</div><a href="../../icapos/index.html">Computer/OS Architecture</a>

</li>
<li class="dir" id="m_icaphw"><div class="i_dir">&nbsp;</div><a href="../../icaphw/index.html">6502 Hardware Bits</a>

</li>
<li class="separator">Misc</li>
<li><div class="i_file">&nbsp;</div><a href="../../contact.html">Contact</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../sneak.html">Sneak preview</a></li>
<li><div class="i_file">&nbsp;</div><a href="../../design.html">Web design</a></li>
</ul>

</div>
		</div><div class="top" id="browser"><div class="tophead">browser</div><div>
			Site has been tested with a number of browsers and systems. Javascript required for advanced menu, but degrades gracefully without Javascript. IE6 not supported anymore!
			</div></div></div><div id="rightcol"><div class="top" id="google"><div class="tophead">search</div><div><form method="get" action="http://www.google.com/search" target="_blank"><input alt="search parameters" type="text" name="q" size="10" maxlength="255" value=""><input class="advbutton" type="submit" value="Search my site"><br>(Google, in new window)
	                        <input type="hidden" name="sitesearch" value="www.6502.org/users/andre"></form></div></div><div class="top" id="share"><div class="tophead">share</div><div><div id="socialshareprivacy"></div></div></div><div class="top" id="twitter"><div class="tophead">follow</div><div>
		            Follow my 8-bit tweets on<br><a class="extlink" target="_blank" href="https://twitter.com/#!/search/realtime/afachat%20%238bit">Twitter</a><br> (In new window)
		</div></div><div class="top" id="forum"><div class="tophead">discuss</div><div><p>Discuss my site on <a class="extlink" target="_blank" href="http://forum.6502.org/viewtopic.php?t=956">this 6502.org forum thread</a></p><p>(Forum registration required to post)</p></div></div><div class="top" id="hot"><div class="tophead">Hot!</div><div>
<p>Dive into the retro feeling and build yourself a <a href="../../cbmhw/ryofat40/index.html">Commodore PET replica</a></p>
<p>Need more speed? Speed up your 6502 computer with this <a href="../../adv65/pet816/index.html">10&nbsp;MHz 6502 CPU replacement board</a></p>
<p>Interested in electronics design? Look at the <a href="../../icaphw/design.html">design lesson</a> I got from Bil Herd, the hardware designer of the C128</p>
<p>Want 64bit? - pimp the 6502 with the <a href="../../65k/index.html">65k processor design!</a></p>

		</div></div></div><div id="midcol"><div class="top" id="ie6warn">
You are using an old MS Internet Explorer as browser. This version is not supported anymore. Please use a 
more modern browser, like Internet Explorer 8 or later, 
<a target="_blank" class="extlink" href="http://www.firefox.com">Firefox</a>,
<a target="_blank" class="extlink" href="http://www.google.com/chrome">Google Chrome</a>, or
<a target="_blank" class="extlink" href="http://www.opera.com">Opera</a>.
</div><div class="top" id="content"><div id="minmax"></div>
<div id="breadcrumbs">
<a href="../../index.html">Homepage</a>
&gt;&gt; <a href="../index.html">ICs and Standards Info</a>&gt;&gt;  SPI (MMC, SD-Cards)</div>
<h1>SPI Information</h1><p class="copyright">(C)
2006-2011 Andr&eacute;  Fachat</p> 
<div class="overview">
	In my <a href="../../csa/index.html">CS/A65</a> computer I use the
	SPI interface to connect and use MMC- and SD-Cards.
  </div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="news">News:</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c"><ul class="news"><li><div>&nbsp;</div><small>2012-01-01</small>
	Added link to Daryl's SPI65 and my own SPI65B solution.
    </li><li><div>&nbsp;</div><small>2011-03-6</small>
	Moved the content from the <a href="../csa/spi/index.html">CS/A MMC page</a> here.
    </li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="modes">SPI</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c">
                <p>SPI means "Serial Peripheral Interface Bus" and is a very
		simple four-wire protocol. Some of the advantages are:
		<ul>
		<li>Each signal is single direction, there are no bi-directional signals</li>
		<li>It is a synchronous bus and clock is controlled by a single source.</li>
		<li>It is byte-oriented</li>
		</ul>
		One of its disadvantages is: it is not exactly well specified:
		</p><p>
		There are these four lines:
		<table border="1"><tr><th>Signal</th><th>Direction</th><th>Description</th></tr>
		<tr><td>/SEL</td><td>SPI Master -&gt; SPI Slave</td><td>If low, the selected device is selected. A master may have multiple of those outputs, but a slave has only one input</td></tr>
		<tr><td>CLK</td><td>SPI Master -&gt; SPI Slave</td><td>Clock for data transfers</td></tr>
		<tr><td>MOSI</td><td>SPI Master -&gt; SPI Slave</td><td>Data from master to slave</td></tr>
		<tr><td>MISO</td><td>SPI Slave -&gt; SPI Master</td><td>Data from slave to master</td></tr>
		</table>
		Beyond that the CLK levels and at which CLK transition the data
		is transferred is not defined!
                </p><h3><a name="modes">SPI Modes</a></h3>
                	<p>
			For this reason there are different possibilities:
			<ul><li>CPOL=0/1: base value of the clock. I.e. the level of the CLK signal when no data transfer is going on.</li>
			<li>CPHA=0/1: The transition of the clock (leading or trailing edge) on which the data is transferred</li>
			</ul>
			This results in the fact that there are four SPI modes,
			<table border="1"><tr><th>Mode</th><th>CPOL</th><th>CPHA</th></tr>
			<tr><td>0</td><td>0</td><td>0</td></tr>
			<tr><td>1</td><td>0</td><td>1</td></tr>
			<tr><td>2</td><td>1</td><td>0</td></tr>
			<tr><td>3</td><td>1</td><td>1</td></tr>
			</table>
			Unfortunately some devices only understand a single 
			mode, and different from other devices, so a master
			should be able to handle all modes.
                	</p><h3><a name="spilinks">Links</a></h3>
			<ul><li><a href="http://en.wikipedia.org/wiki/Serial_Peripheral_Interface_Bus">Wikipedia</a> has some more detailled info</li>
			</ul>
			</div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2><a name="mmcsdc">MMC and SD-Cards</a></h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c">
                <p>
		MMC-Card and SD-Cards are cheap means of getting large amounts
		of storage memory nowadays. And they are getting larger and
		cheaper every day. Those cards are based on flash memory
		and can be found in digital cameras, navigation systems, 
		and many more.
		</p>
		<p>Unfortunately the MMC- and SD-Card protocols are not free,
		 however a certain amount of intelligence has been gathered
		and is available on the web:
		<ul><li><a href="http://en.wikipedia.org/wiki/MultiMediaCard">Wikipedia on MMCs</a></li>
		<li><a href="http://en.wikipedia.org/wiki/Secure_Digital_card">Wikipedia on Secure Digital Cards</a></li>
		<li><a href="http://elm-chan.org/docs/mmc/mmc_e.html">How to use MMC/SDC</a></li>
		</ul>
		as well as in datasheets for MMC or SD-Cards found on the 
		producers homepages.
                </p><h3><a name="spimodes">MMC/SD SPI mode</a></h3><p>
			Newer MMC and especially SD-Cards use a mode
			where more than a single bit is transferred per
			clock. In fact the cards have four data lines that
			are used in native mode. This mode is however
			more complicated. But, we are lucky, all cards
			still support the SPI mode, that they can enter
			upon startup when instructed to do so. And this is
			what the driver does.
			</p><p>
			One problem I had in the beginning was that the
			datasheets mentioned the data transfer on the 
			rising edge of the clock, but not what 
			clock level would be correct. By experimentation
			I found that MMCs and SD-Cards use mode 0.
			</p></div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2>SPI Links</h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c">
    <ul><li class="subitem"><a href="http://en.wikipedia.org/wiki/Serial_Peripheral_Interface_Bus" target="_new" class="extlink">Wikipedia</a> 
	The wikipedia article on SPI.
     </li><li class="subitem"><a href="http://sbc.rictor.org/" target="_new" class="extlink">Daryl Rictor's SPI65</a> 
	If you click on "65SPI" on the left navigation on that page, you find Daryl Rictor's 
	65SPI solution, a Xilinx 9572 CPLD-based SPI solution.
     </li><li class="subitem"><a href="spi65b/index.html" target="_new" class="extlink">SPI65/B</a> 
	Based on the specifications of Dary's solution, I have re-implemented it in VHDL with some
	modifications. See the descriptions after the link.
     </li></ul></div></div><div class="h2"><div class="h2h"><div class="h2t">&nbsp;</div><h2>Disclaimer</h2><div class="toplink"><a href="#top">Top</a></div></div><div class="h2c">
All Copyrights are acknowledged. There is no warranty attached to the information on these pages.
  </div></div><hr>
Contents last modified 2012-01-04.
<p>Return to <a href="../../index.html">Homepage</a></p>

  </div></div><div id="footer">&nbsp;</div></div><script type="text/javascript">myUp="../../";</script><script type="text/javascript" src="../../scripts-all.js"></script><script type="text/javascript" src="../../jquery.socialshareprivacy.js"></script><script type="text/javascript">
          jQuery(document).ready(function($){
                  if($('#socialshareprivacy').length != 0){
                            $('#socialshareprivacy').socialSharePrivacy();
                  }
          });
  </script></body></html> 
